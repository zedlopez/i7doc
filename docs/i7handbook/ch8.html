<!doctype html>
<html lang="en"><head><meta charset="utf-8">
<title>Inform 7 Handbook</title>
<script src="../i7doc.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,375;0,400;0,500;0,700;1,375;1,400;1,500;1,700&family=Source+Sans+Pro:ital,wght@0,350;0,400;0,550;0,700;1,350;1,400;1,550;1,700&display=swap" rel="stylesheet"> 
<link rel="stylesheet" href="../i7doc.css">
<link rel="stylesheet" href="i7handbook.css">
  </head>
  <body>
    <header>
      <h1 id="inform7-handbook">Inform 7 Handbook</h1>
      <h2>by Jim Aikin</h2>
    </header>
    <main>
<h2 id="chapter-8-time-scenes">Chapter 8: Time &amp; Scenes</h2>

<p>Lots of interactive fiction games take place in a sort of “eternal now.”
The player is free to wander around, trying whatever commands she thinks
of. No matter how many turns she takes, nothing changes in the model
world except when she takes an action that changes it.</p>

<p>In other games, though, the passage of time has some effect on the
game-play. That is, the game counts the number of turns the player
spends doing things, and makes some change after a set number of turns.
For instance, the sun might set, in which case outdoor rooms would
become dark. In almost all games, nothing whatever happens between the
player’s commands: time passes only when the player does something. A
very few games include some sort of “real time” routine to force the
player to type the correct command within a few seconds, but these games
are quite rare, and we’re not going to worry about them in this book.</p>

<p>Inform has three systems with which you can organize the passage of time
of your game. In this chapter we’ll look at all of them.</p>

<h3 id="passing-time">Passing Time</h3>

<p>Inform doesn’t do anything to mark the passage of time in a game unless
you tell it to. All the same, it’s quietly keeping track of the number
of turns that have passed since the beginning of the game. Unless you
write some code that changes the default, Inform starts the game at 9:00
A.M. Each time the player enters a sensible command, one minute passes.
But if the player types something that the parser doesn’t understand, no
time passes.</p>

<p>A simple way to see this mechanism in action is to add this code to your
game:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`When play begins:\n\tnow the right hand status line is &quot;[time of day]&quot;.`)"><span class="sym">⧉</span></button>
<div class="codeline">When play begins:</div>
<div class="codeline">&ensp;&ensp;&ensp;now the right hand status line is &quot;[time of day]&quot;.</div>
</div>
<p>The status line<span id="Ref_status_line" class="anchor"></span> is the bar
across the top of the game window. Normally (unless you do something to
change it), the right side of the status line is empty, but this code
can be used to show the number of points the player has earned
(“[score]”), for example. The code above changes the status line to
show the time of day. For more, see <a href="../WI_8.html#section3">WI 8.3: Changing the status
line</a>.</p>

<p>As a courtesy to the player, you might want to have no time pass when
the player is simply using the LOOK command to refresh her memory about
the room, or the INV (or I) command to remind herself what she’s
carrying. To do that, use this code:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Every turn:\n\tif the current action is taking inventory or the current action is looking:\n\t	now the time of day is 1 minute before the time of day.`)"><span class="sym">⧉</span></button>
<div class="codeline">Every turn:</div>
<div class="codeline">&ensp;&ensp;&ensp;if the current action is taking inventory or the current action is looking:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;now the time of day is 1 minute before the time of day.</div>
</div>
<p>We’ll have more to say about Every Turn rules later in this chapter.
Another way to do the same thing is to use a Before rule rather than an
Every Turn rule:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Before looking or taking inventory:\n\tnow the time of day is 1 minute before the time of day.`)"><span class="sym">⧉</span></button>
<div class="codeline">Before looking or taking inventory:</div>
<div class="codeline">&ensp;&ensp;&ensp;now the time of day is 1 minute before the time of day.</div>
</div>
<p>The downside of using a Before rule in this case is that the first
action when a game starts is a look action. That’s what causes the
initial room description to print. So if you use a Before rule in this
case, the game will be starting one minute before you think it does,
which could be a problem in a game that opens with a tight timing
puzzle.</p>

<p><a href="../examples/timeless.html">Example 408: Timeless</a>, shows a different
way to accomplish the same thing.</p>

<p>The game doesn’t have to start at 9:00 A.M. If you want it to start at
3:00 in the afternoon, do this:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`When play begins:\n\tnow the time of day is 3:00 pm.`)"><span class="sym">⧉</span></button>
<div class="codeline">When play begins:</div>
<div class="codeline">&ensp;&ensp;&ensp;now the time of day is 3:00 pm.</div>
</div>
<p>If you want time to jump ahead for some reason (such as when the player
character has been hit on the head and is unconscious for a while),
include a line like this in your code as part of what happens when the
player is hit:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`now the time of day is 7:00 pm.`)"><span class="sym">⧉</span></button>
<div class="codeline">now the time of day is 7:00 pm.</div>
</div>
<p>If you want something to happen at a specific time, one way to do it –
the primitive, clumsy way, as I’ll explain in a moment – is with an
Every Turn rule:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Every turn:\n\tif the time of day is 11:59 pm or the time of day is 12:59 am or the time of day is 1:59 am:\n\t	say &quot;In the distance you hear the chimes in the tower strike the hour.&quot;`)"><span class="sym">⧉</span></button>
<div class="codeline">Every turn:</div>
<div class="codeline">&ensp;&ensp;&ensp;if the time of day is 11:59 pm or the time of day is 12:59 am or the time of day is 1:59 am:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;say &quot;In the distance you hear the chimes in the tower strike the hour.&quot;</div>
</div>
<p>As you can see, I’ve set the chimes to ring one minute <em>before</em> the
hour. This is because of the way Inform runs your Every Turn rules.
Every Turn rules run before the Advance Time rule. If you do it as shown
above, the message about the chimes in the tower will be printed out on
the hour.</p>

<p>In this case, Inform has a simpler way to get the same effect. You can
write a rule that tells the game what to do at specific times:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`At 11:59 pm: say chimes.\nAt 12:59 am: say chimes.\nAt 1:59 am: say chimes.\n\nTo say chimes: say &quot;In the distance you hear the chimes in the tower strike the hour.&quot;`)"><span class="sym">⧉</span></button>
<div class="codeline">At 11:59 pm: say chimes.</div>
<div class="codeline">At 12:59 am: say chimes.</div>
<div class="codeline">At 1:59 am: say chimes.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">To say chimes: say &quot;In the distance you hear the chimes in the tower strike the hour.&quot;</div>
</div>
<p>This way of doing it is easier to write and debug, especially when you
want the chimes to ring every hour for 24 hours, rather than only at
three times, as shown.</p>

<p>The main reason to want to keep track of the current time (and let the
player know what time it is) is because time is passing in the model
world. In some games, the player character will get hungry and/or
thirsty on a regular schedule, so finding food and water will be one of
the puzzles. If the game includes a realistic alternation of day and
night, at a certain time in the evening the player might need to find a
place to sleep. Some people consider eating and sleeping puzzles
old-fashioned, but timed puzzles can be interesting if handled in a
creative way.</p>

<h3 id="future-events">Future Events</h3>

<p><a href="../WI_9.html#section11">WI 9.11: Future events</a> shows how to cue up
events that will happen at a certain time in the future. For the next
example, I’ll borrow some code from the chapter of the <em>Handbook</em> on
characters. When the player tries to take the spider, not only the game
prevent the action, but there will be an after-effect – a sort of
emotional echo of the intended action:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Instead of taking the spider:\n\tsay &quot;You can&apos;t bring yourself even to get near it.&quot;;\n\tthe spider thought returns in four minutes from now.\n\nAt the time when the spider thought returns:\n\tsay &quot;You&apos;re still thinking about that creepy spider…&quot;`)"><span class="sym">⧉</span></button>
<div class="codeline">Instead of taking the spider:</div>
<div class="codeline">&ensp;&ensp;&ensp;say &quot;You can&apos;t bring yourself even to get near it.&quot;;</div>
<div class="codeline">&ensp;&ensp;&ensp;the spider thought returns in four minutes from now.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">At the time when the spider thought returns:</div>
<div class="codeline">&ensp;&ensp;&ensp;say &quot;You&apos;re still thinking about that creepy spider…&quot;</div>
</div>
<p>Here I’ve created a new phrase, “the spider thought returns,” and told
Inform what to do when that event happens. There are two ways to cue
this action: You can say “in four minutes from now” or “in four turns
from now” (substituting your own number of turns or minutes, obviously).
If you’re making adjustments in the time of day, as shown earlier in
this chapter in the section “Passing Time,” four minutes from now will
<em>not</em> necessarily be the same as four turns from now. The handy thing
about this code is that the spider thought time will be reset if the
player tries to take the spider several times in a row: The thought
return will happen only once. If the player then tries to take the
spider <em>after</em> the thought has returned the first time, the thought can
return a second time.</p>

<p>If you need to trigger a more complex series of events rather than
something that happens once, using Scenes (see below) will give you
better tools.</p>

<p>If you want something to <em>maybe</em> happen in the future, depending on some
factor, you can use Inform’s handy “do nothing” phrase. The example
below was suggested by one of my students, who wanted to transform a
magic wand into an old shoe – but only if the player has been carrying
the wand for three turns in a row.</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`The Wizard&apos;s Workshop is a room. &quot;This odd-smelling little room is crowded with tables and shelves overflowing with magical implements.&quot;\n\nThe magic wand is in the Wizard&apos;s Workshop. &quot;A Wham-O(tm) magic wand lies on the floor.&quot; The description is &quot;It&apos;s a shiny black plastic wand on which the words &apos;Wham-O&apos; are written in flowing white script.&quot;\nUnderstand &quot;wham-o&quot;, &quot;shiny&quot;, &quot;black&quot;, and &quot;plastic&quot; as the magic wand.\n\nThe old shoe is a thing. The description is &quot;It looks like somebody left it lying in the gutter.&quot;\n\nAfter taking the magic wand:\n\tthe wand transforms in three turns from now;\n\tcontinue the action.\n\nAt the time when the wand transforms:\n\tif the player does not carry the wand:\n\t	do nothing;\n\totherwise:\n\t	remove the magic wand from play;\n\t	now the player carries the old shoe;\n\t	say &quot;The wand quivers and squirms in your hand! Suddenly it&apos;s not a wand, it&apos;s an old shoe!&quot;`)"><span class="sym">⧉</span></button>
<div class="codeline">The Wizard&apos;s Workshop is a room. &quot;This odd-smelling little room is crowded with tables and shelves overflowing with magical implements.&quot;</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">The magic wand is in the Wizard&apos;s Workshop. &quot;A Wham-O(tm) magic wand lies on the floor.&quot; The description is &quot;It&apos;s a shiny black plastic wand on which the words &apos;Wham-O&apos; are written in flowing white script.&quot;</div>
<div class="codeline">Understand &quot;wham-o&quot;, &quot;shiny&quot;, &quot;black&quot;, and &quot;plastic&quot; as the magic wand.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">The old shoe is a thing. The description is &quot;It looks like somebody left it lying in the gutter.&quot;</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">After taking the magic wand:</div>
<div class="codeline">&ensp;&ensp;&ensp;the wand transforms in three turns from now;</div>
<div class="codeline">&ensp;&ensp;&ensp;continue the action.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">At the time when the wand transforms:</div>
<div class="codeline">&ensp;&ensp;&ensp;if the player does not carry the wand:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;do nothing;</div>
<div class="codeline">&ensp;&ensp;&ensp;otherwise:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;remove the magic wand from play;</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;now the player carries the old shoe;</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;say &quot;The wand quivers and squirms in your hand! Suddenly it&apos;s not a wand, it&apos;s an old shoe!&quot;</div>
</div>
<p>Here, we start Inform’s internal “alarm clock” ticking when the player
takes the magic wand, using an After rule. If the player isn’t carrying
the wand when the “alarm clock” goes off, nothing happens. And if the
player drops the wand and picks it up again, Inform will automatically
reset the clock. The wand will only transform if it’s carried for three
turns in a row. Obviously, this type of scheduling of future events has
many other uses. In the code above, the transformation can occur only
once, because the wand ends up off-stage as a result of the
transformation. If you’re planning to use teleportation (moving the wand
somewhere interesting) rather than transformation, you’ll need to think
closely about what happens if the player triggers the event again later.</p>

<h3 id="scenes">Scenes</h3>

<p>One of the more powerful features of Inform is its ability to organize
the story into scenes. An entire chapter of <a href="../WI_10.html"><em>Writing with Inform</em>
(Chapter 10, “Scenes”)</a>, is devoted to scenes. If you
haven’t read this chapter yet, give it a look. Some games won’t need
scenes at all, but scenes can be very handy for giving your story some
structure. Almost any time you need to create a complex,
well-coordinated set of changes in the model world, defining a scene is
a good tool for the job.</p>

<p>To create a scene, you simply give it a name, and then tell Inform when
it starts – that is, what set of events or circumstances triggers it.
You can also, optionally, tell Inform when the scene ends. By default, a
scene will happen only once. If you want it to be able to happen over
and over, you need to create it as a <em>recurring</em> scene.</p>

<p>Why might you want to use a scene? Here are some random ideas:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Saucer-menace is a scene. Saucer-menace begins when the flying saucer is in the Meadow. Saucer-menace ends when the bug-eyed monster is dead.\n\nGuard-evasion is a scene. Guard-evasion begins when the security guard is suspicious. Guard-evasion ends when the player is in the Bank Vault for the first time. \n\nDance mania is a scene. Dance mania begins when the player is in the Abandoned Warehouse for the first time. Dance mania ends when the police sergeant is in the Abandoned Warehouse.`)"><span class="sym">⧉</span></button>
<div class="codeline">Saucer-menace is a scene. Saucer-menace begins when the flying saucer is in the Meadow. Saucer-menace ends when the bug-eyed monster is dead.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">Guard-evasion is a scene. Guard-evasion begins when the security guard is suspicious. Guard-evasion ends when the player is in the Bank Vault for the first time. </div>
<div class="codeline">&thinsp;</div>
<div class="codeline">Dance mania is a scene. Dance mania begins when the player is in the Abandoned Warehouse for the first time. Dance mania ends when the police sergeant is in the Abandoned Warehouse.</div>
</div>
<p>When a certain scene starts, you might want to rearrange the objects in
the model world, shuffling some items offstage and others onstage. While
the scene is happening, you might want to restrict the player’s travel,
or print out certain atmospheric messages (as shown in <a href="../WI_10.html#section4">WI 10.4: During
scenes</a>). While a scene is happening, the
magical weapons the player is carrying might have different effects than
at other times. The possibilities are unlimited.</p>

<p>You can’t start a scene simply by saying that it starts:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`now guard-evasion is happening; [Error!]`)"><span class="sym">⧉</span></button>
<div class="codeline">now guard-evasion is happening; [Error!]</div>
</div>
<p>Nor can you end a scene by saying that it ends. The way to start or end
a scene is to tie it to a condition, as shown above:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Guard-evasion begins when the security guard is suspicious.`)"><span class="sym">⧉</span></button>
<div class="codeline">Guard-evasion begins when the security guard is suspicious.</div>
</div>
<p>The condition can be as simple as whether a truth state that varies (a
true-or-false variable) is true or false. You could do it this way:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Guard-evasion-flag is a truth state that varies. Guard-evasion-flag is false.\n\nGuard-evasion is a scene. Guard-evasion begins when guard-evasion-flag is true.`)"><span class="sym">⧉</span></button>
<div class="codeline">Guard-evasion-flag is a truth state that varies. Guard-evasion-flag is false.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">Guard-evasion is a scene. Guard-evasion begins when guard-evasion-flag is true.</div>
</div>
<p>Having set it up this way, you can start the scene whenever or wherever
you like by writing:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`now guard-evasion-flag is true;`)"><span class="sym">⧉</span></button>
<div class="codeline">now guard-evasion-flag is true;</div>
</div>
<h4 id="chaining-scenes">Chaining Scenes</h4>

<p><a href="../WI_10.html#section5">WI 10.5: Linking scenes together</a> gives this
simple example of how to chain two scenes:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Train Stop is a scene. Brief Encounter is a scene. Brief Encounter begins when Train Stop ends.`)"><span class="sym">⧉</span></button>
<div class="codeline">Train Stop is a scene. Brief Encounter is a scene. Brief Encounter begins when Train Stop ends.</div>
</div>
<p>From this code, we can’t tell what events will cause Train Stop to begin
or end, but we can see that Brief Encounter will begin immediately when
Train Stop ends.</p>

<p>Setting up a new scene so that it starts a certain number of turns after
a previous scene ends is a little trickier. First, we need to create a
truth state. Second, we need to write a simple function that will switch
the truth state to true. Third, we need to tell Inform to run the
function at some time in the future. Here’s an example that shows how to
do it:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`The Antechamber is a room. &quot;The princess&apos;s boudoir lies to the south.&quot;\n\nThe Princess&apos;s Boudoir is south of the Antechamber. &quot;This luxuriously appointed chamber is fit for a princess.&quot;\n\nThe princess is a woman in the Boudoir. &quot;…and as it happens, a princess is sitting here right now!&quot;\n\nThe player carries some crown jewels. The indefinite article of the crown jewels is &quot;the&quot;.\n\nPrincess Demanding is a recurring scene. Princess Demanding begins when the player is in the Boudoir and the player carries the crown jewels.\n\nPrincess Demanding ends when the player does not carry the crown jewels.\n\nInstead of going during Princess Demanding:\n\tsay &quot;&apos;You&apos;re not going anywhere until you surrender the jewels!&apos; the princess insists.&quot;\n\nWhen Princess Demanding begins:\n\tsay &quot;&apos;I notice you&apos;re carrying the crown jewels,&apos; the princess says. &apos;Give them to me at once!&apos;&quot;\n\nInstead of giving the jewels to the princess:\n\tnow the princess carries the jewels;\n\tsay &quot;You surrender the jewels. The princess smiles sweetly. &apos;Thank you,&apos; she says. &apos;You may go.&apos;&quot;`)"><span class="sym">⧉</span></button>
<div class="codeline">The Antechamber is a room. &quot;The princess&apos;s boudoir lies to the south.&quot;</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">The Princess&apos;s Boudoir is south of the Antechamber. &quot;This luxuriously appointed chamber is fit for a princess.&quot;</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">The princess is a woman in the Boudoir. &quot;…and as it happens, a princess is sitting here right now!&quot;</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">The player carries some crown jewels. The indefinite article of the crown jewels is &quot;the&quot;.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">Princess Demanding is a recurring scene. Princess Demanding begins when the player is in the Boudoir and the player carries the crown jewels.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">Princess Demanding ends when the player does not carry the crown jewels.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">Instead of going during Princess Demanding:</div>
<div class="codeline">&ensp;&ensp;&ensp;say &quot;&apos;You&apos;re not going anywhere until you surrender the jewels!&apos; the princess insists.&quot;</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">When Princess Demanding begins:</div>
<div class="codeline">&ensp;&ensp;&ensp;say &quot;&apos;I notice you&apos;re carrying the crown jewels,&apos; the princess says. &apos;Give them to me at once!&apos;&quot;</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">Instead of giving the jewels to the princess:</div>
<div class="codeline">&ensp;&ensp;&ensp;now the princess carries the jewels;</div>
<div class="codeline">&ensp;&ensp;&ensp;say &quot;You surrender the jewels. The princess smiles sweetly. &apos;Thank you,&apos; she says. &apos;You may go.&apos;&quot;</div>
</div>
<p>Here we’ve created a scene called Princess Demanding. The point of this
scene is the “Instead of going” rule. This rule gets in the way if the
player tries to leave the boudoir with the jewels. Other than this, the
scene is transparent – that is, it has no effect on game-play. The
player can drop the jewels or give them to the princess. At that point,
the scene ends (because we’ve written a rule that defines this as ending
the scene).</p>

<p>The keyword “during” in this Instead rule lets us write code that will
make sweeping changes in many aspects of the game depending on whether a
certain scene is happening.</p>

<p>We’ve made Princess Demanding a recurring scene. This is necessary. If
you leave out the word “recurring,” the player can get away with the
jewels by dropping them in the boudoir and then picking them up again.
When they’re dropped, the scene ends – and if it’s not a recurring
scene, it will never start again.</p>

<p>Let’s look at this scene more closely. It looks sensible on the surface,
but in fact there are some problems. By analyzing the problems, you can
start to get a better picture of how to write trouble-free code.</p>

<p>In a real game the player would quite likely be able to figure out a way
to abscond with the jewels, even after the princess has noticed them.
Can you spot the problem? If you’ve read the section in Chapter 3 on
“Testing Where a Thing Is,” you may recall that the condition “if the
player carries the crown” is only true if the crown is in the PC’s hands
– that is, if it’s directly carried. The bug will show up if we give the
player a container for carrying things:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`The sack is a container. The player carries the sack.`)"><span class="sym">⧉</span></button>
<div class="codeline">The sack is a container. The player carries the sack.</div>
</div>
<p>Now the player can walk into the boudoir, which will cause the princess
to notice the jewels, and then put the jewels in the sack and walk
straight out again. Oops! The fix for this bug is simple. We change
“carries” in the end-of-scene statement to “encloses”:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Princess Demanding ends when the player does not enclose the crown jewels.`)"><span class="sym">⧉</span></button>
<div class="codeline">Princess Demanding ends when the player does not enclose the crown jewels.</div>
</div>
<p>If you make these changes, the player will be able to put the jewels in
the sack and then enter the boudoir, and the princess will let him leave
again. Presumably, she hasn’t noticed the jewels because they’re in the
sack. But once the jewels are not in the sack but in the PC’s hands,
she’ll see them. At that point, putting them back in the sack won’t
help. The princess will still demand that they be turned over.</p>

<p>But there’s still a problem. Try this series of commands:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Test me with &quot;s / put jewels in sack / drop sack / take sack / n&quot;.`)"><span class="sym">⧉</span></button>
<div class="codeline">Test me with &quot;s / put jewels in sack / drop sack / take sack / n&quot;.</div>
</div>
<p>The princess will notice the jewels … but you can still get away with
them by putting them in the sack, dropping the sack, and picking it up
again, because the Princess Demanding scene won’t start again as long as
the jewels are in the sack. Ah, but we don’t want to change the
definition of the start of the scene so that it uses “encloses” rather
than “carries,” because that would cause the princess to notice the
jewels for the first time even if they’re in the sack. What a tangle!</p>

<p>The solution is in two parts. First, we need to keep track of what the
princess knows. In addition, we’ll create a second scene, Princess Still
Demanding. This scene will do the work of stopping the player from
leaving – and it will have a more complicated beginning. Here’s the
revised part of the code:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`The princess is a woman in the Boudoir. &quot;…and as it happens, a princess is sitting here right now!&quot;\nThe princess can be jewel-knowing or jewel-ignorant. The princess is jewel-ignorant.\n\nWhen Princess Demanding begins:\n\tnow the princess is jewel-knowing.\n\nThe player carries some crown jewels. The indefinite article of the crown jewels is &quot;the&quot;.\n\nThe sack is a container. The player carries the sack.\n\nPrincess Demanding is a scene. Princess Demanding begins when the player is in the Boudoir and the player carries the crown jewels.\n\nPrincess Still Demanding is a recurring scene. Princess Still Demanding begins when the player is in the boudoir and the player encloses the crown jewels and the princess is jewel-knowing.\n\nPrincess Demanding ends when Princess Still Demanding begins.\n\nPrincess Still Demanding ends when the player does not enclose the crown jewels.\n\nInstead of going during Princess Still Demanding:\n\tsay &quot;&apos;You&apos;re not going anywhere until you surrender the jewels!&apos; the princess insists.&quot;`)"><span class="sym">⧉</span></button>
<div class="codeline">The princess is a woman in the Boudoir. &quot;…and as it happens, a princess is sitting here right now!&quot;</div>
<div class="codeline">The princess can be jewel-knowing or jewel-ignorant. The princess is jewel-ignorant.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">When Princess Demanding begins:</div>
<div class="codeline">&ensp;&ensp;&ensp;now the princess is jewel-knowing.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">The player carries some crown jewels. The indefinite article of the crown jewels is &quot;the&quot;.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">The sack is a container. The player carries the sack.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">Princess Demanding is a scene. Princess Demanding begins when the player is in the Boudoir and the player carries the crown jewels.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">Princess Still Demanding is a recurring scene. Princess Still Demanding begins when the player is in the boudoir and the player encloses the crown jewels and the princess is jewel-knowing.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">Princess Demanding ends when Princess Still Demanding begins.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">Princess Still Demanding ends when the player does not enclose the crown jewels.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">Instead of going during Princess Still Demanding:</div>
<div class="codeline">&ensp;&ensp;&ensp;say &quot;&apos;You&apos;re not going anywhere until you surrender the jewels!&apos; the princess insists.&quot;</div>
</div>
<p>The first thing we’ve done here is give the princess a new either-or
property. She can be jewel-knowing or jewel-ignorant. At the beginning
of the game she’s jewel-ignorant. But when Princess Demanding begins,
she becomes jewel-knowing. The moment she becomes jewel-knowing, the
game switches to a different scene, Princess Still Demanding.</p>

<p>If you add this code to the original version of the example, the player
will be able to go in and out of the boudoir freely carrying the jewels
in the sack. But once the princess spies the jewels, the player will be
prevented from leaving whether the jewels are directly carried or are
being carried in a container.</p>

<p>There’s still at least one more problem with this example game, which
illustrates just how tricky writing IF can be. If the player drops the
jewels on the floor, the princess will just leave them lying there.
She’ll let you leave, but if you leave the boudoir and come back, you’ll
find that the jewels are still lying on the floor in plain sight. A
writer of conventional fiction might describe this by saying that the
princess’s motivation (her reasons for her actions) is not consistent.
We can fix this with an Every Turn rule:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Every turn:\n\tif the holder of the crown jewels is the Boudoir:\n\t	now the princess carries the crown jewels;\n\t	say &quot;The princess scoops up the jewels. &apos;These belong to my family,&apos; she says, adding haughtily, &apos;you may go.&apos;&quot;`)"><span class="sym">⧉</span></button>
<div class="codeline">Every turn:</div>
<div class="codeline">&ensp;&ensp;&ensp;if the holder of the crown jewels is the Boudoir:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;now the princess carries the crown jewels;</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;say &quot;The princess scoops up the jewels. &apos;These belong to my family,&apos; she says, adding haughtily, &apos;you may go.&apos;&quot;</div>
</div>
<p>As an exercise, I’ll leave you the chore of setting it up so that if the
princess is jewel-knowing, the jewels are in the sack, and the sack is
on the floor of the boudoir, the princess will take the jewels from the
sack. The moral of the story is this: When planning an action, think
about <em>all</em> of the actions a player might take. Think about all of the
configurations the various objects might get into. Also, think about how
any other characters in the room would naturally react when the PC does
something or other.</p>

<h3 id="every-turn-rules">Every Turn Rules</h3>

<p>We’ve already seen a couple of examples of Every Turn rules. As you can
guess from the name of the rule, an Every Turn rule is consulted every
turn to see whether it would like to do anything. This rule is consulted
as the <em>last</em> step in the process that starts when the player types a
command. The output of an Every Turn rule will normally appear at the
bottom of a block of text in the game, after the description of whatever
happens as a result of the player’s latest command.</p>

<p>An Every Turn rule can print out some text, or it can do something more
complicated. Printing out some text is a nice way to add atmosphere to
your game, but a message that prints every turn will quickly become
annoying. Here’s an Every Turn rule that adds atmosphere to a forest
setting in a slightly more interesting way. Sometimes it chooses a
random text to print, and sometimes it does nothing:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Every turn:\n\tif a random chance of 1 in 3 succeeds:\n\t	say &quot;[one of]A dragonfly darts past you.[or]You hear a frog croaking.[or]A bird chirps in the bushes.[or]The breeze rustles the leaves.[at random]&quot;.`)"><span class="sym">⧉</span></button>
<div class="codeline">Every turn:</div>
<div class="codeline">&ensp;&ensp;&ensp;if a random chance of 1 in 3 succeeds:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;say &quot;[one of]A dragonfly darts past you.[or]You hear a frog croaking.[or]A bird chirps in the bushes.[or]The breeze rustles the leaves.[at random]&quot;.</div>
</div>
<p>But even with a bit of randomness, this type of Every Turn rule will get
boring before very long. A better solution is to write an Every Turn
rule that only runs when a certain scene is happening, or when the
player is in a certain region. If we have defined the Forest Area as a
region, we could rewrite the rule above like this:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Every turn when the player is in the Forest Area:`)"><span class="sym">⧉</span></button>
<div class="codeline">Every turn when the player is in the Forest Area:</div>
</div>
<p>If we’ve created a scene called Forest Explorations, we could do it this
way:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Every turn during Forest Explorations:`)"><span class="sym">⧉</span></button>
<div class="codeline">Every turn during Forest Explorations:</div>
</div>
<p>In fact, if you’re concerned about writing efficient code so that your
game won’t be sluggish when played in the current generation of Web
browsers (and this is something to be concerned about), qualifying your
Every Turn rules in this way, so that they’re only consulted by the game
when specific scenes are active, is a good idea.</p>

<p>We can also write an Every Turn rule that will produce some narrative or
background text at specific points within a scene. Here, the phrase
“exactly three turns” will insure that the output text is produced only
once (unless the scene is recurring, in which case it will be produced
once per recurrence):</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Every turn:\n\tif Saucer Menace has been happening for exactly three turns:\n\t	say &quot;You hear an odd glorping noise somewhere nearby.&quot;;\n\totherwise if Saucer Menace has been happening for exactly five turns:\n\t	say &quot;Was that a tentacle you saw slithering out of sight?&quot;`)"><span class="sym">⧉</span></button>
<div class="codeline">Every turn:</div>
<div class="codeline">&ensp;&ensp;&ensp;if Saucer Menace has been happening for exactly three turns:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;say &quot;You hear an odd glorping noise somewhere nearby.&quot;;</div>
<div class="codeline">&ensp;&ensp;&ensp;otherwise if Saucer Menace has been happening for exactly five turns:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;say &quot;Was that a tentacle you saw slithering out of sight?&quot;</div>
</div>
<p>An Every Turn rule can also wait quietly in the background, checking for
a certain set of conditions, and then do something when the conditions
are met. Here’s a simple game that shows how the idea might work:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`The Throne Room is a room. &quot;The king&apos;s golden throne stands here.&quot;\n\nThe golden throne is an enterable scenery supporter in the Throne Room. The description is &quot;A magnificent golden throne.&quot;\n\nThe jewelled sceptre is here. The sparkling crown is here. The crown is wearable.\n\nEvery turn:\n\tif the player wears the sparkling crown and the player carries the jewelled sceptre and the player is on the golden throne:\n\t	say &quot;You&apos;re the king!!!&quot;;\n\t	end the story saying “Congratulations!”`)"><span class="sym">⧉</span></button>
<div class="codeline">The Throne Room is a room. &quot;The king&apos;s golden throne stands here.&quot;</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">The golden throne is an enterable scenery supporter in the Throne Room. The description is &quot;A magnificent golden throne.&quot;</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">The jewelled sceptre is here. The sparkling crown is here. The crown is wearable.</div>
<div class="codeline">&thinsp;</div>
<div class="codeline">Every turn:</div>
<div class="codeline">&ensp;&ensp;&ensp;if the player wears the sparkling crown and the player carries the jewelled sceptre and the player is on the golden throne:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;say &quot;You&apos;re the king!!!&quot;;</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;end the story saying “Congratulations!”</div>
</div>
<p>Every turn, this rule checks to see whether the player has done all
three things that are needed to win: the player has to be carrying the
sceptre and wearing the crown while sitting on the throne. You could get
the same results using After rules for three different actions (after
taking the sceptre, after wearing the crown, and entering the throne),
and test in each of the After rules for whether the other two conditions
were satisfied – but using an Every Turn rule is less likely to lead to
a bug, because you can test all three conditions in one place. And if
you need to edit the code for some reason, you only need to edit it in
one place; you don’t need to hunt for every spot in the code where that
condition is being checked.</p>

<p>Here’s another way to get the same result:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`Every turn when the player is on the golden throne:\n\tif the player wears the sparkling crown and the player carries the jewelled sceptre:\n\t	say &quot;You&apos;re the king!!!&quot;;\n\t	end the story saying “Congratulations!”`)"><span class="sym">⧉</span></button>
<div class="codeline">Every turn when the player is on the golden throne:</div>
<div class="codeline">&ensp;&ensp;&ensp;if the player wears the sparkling crown and the player carries the jewelled sceptre:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;say &quot;You&apos;re the king!!!&quot;;</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;end the story saying “Congratulations!”</div>
</div>
<p>As this example shows, an Every Turn rule can include a test in its
first line. If we’re writing a game in which the player needs to eat
periodically, we might do something like this:</p>

<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`A person can be hungry or not hungry. A person is usually not hungry.\nThe player has a number called hunger-level. The hunger-level of the player is 0.\nEvery turn when the player is hungry:\n\tincrease the hunger-level of the player by 1;\n\tsay &quot;[one of]Your stomach is rumbling.[or]You&apos;re becoming quite hungry.[or]You&apos;re very hungry. You need to find food soon.[or]You&apos;re practically starving![stopping]&quot;;\n\tif the hunger-level of the player is 7:\n\t	end the story saying &quot;You have starved to death!&quot;`)"><span class="sym">⧉</span></button>
<div class="codeline">A person can be hungry or not hungry. A person is usually not hungry.</div>
<div class="codeline">The player has a number called hunger-level. The hunger-level of the player is 0.</div>
<div class="codeline">Every turn when the player is hungry:</div>
<div class="codeline">&ensp;&ensp;&ensp;increase the hunger-level of the player by 1;</div>
<div class="codeline">&ensp;&ensp;&ensp;say &quot;[one of]Your stomach is rumbling.[or]You&apos;re becoming quite hungry.[or]You&apos;re very hungry. You need to find food soon.[or]You&apos;re practically starving![stopping]&quot;;</div>
<div class="codeline">&ensp;&ensp;&ensp;if the hunger-level of the player is 7:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;end the story saying &quot;You have starved to death!&quot;</div>
</div>
<p>Switching the player to hungry would happen elsewhere in the code. In
this example we’ve added something new – a counter (hunger-level) that
keeps track of how long the player has been hungry, and ends the game
after a set number of turns. When the player eats food, your code would
both switch the player to not hungry and reset the hunger-level of the
player to 0.</p>


</main>
<footer>
  <p><em>The Inform 7 Handbook</em> is copyright &copy; 2015 by Jim Aikin, and released under a <a href="https://creativecommons.org/licenses/by-nc/1.0/legalcode">CC-BY-NC 1.0 license</a>.</p>
</footer>
</body>
</html>
