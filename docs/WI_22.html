<!doctype html>
<html lang="en"><head><meta charset="utf-8">
<title>WI 22. Advanced Phrases</title>
<script src="i7doc.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,375;0,400;0,500;0,700;1,375;1,400;1,500;1,700&family=Source+Sans+Pro:ital,wght@0,350;0,400;0,550;0,700;1,350;1,400;1,550;1,700&display=swap" rel="stylesheet"> 
<link rel="stylesheet" href="i7doc.css">
</head>
<nav><div class="nav-el"><a class="raw nav-el" href="index.html">Contents</a></div><div class="nav-el"><a class="raw nav-el" href="examples/index.html">Examples</a></div><div class="nav-el"><a class="raw nav-el" href="general_index.html">Index</a></div><div class="nav-el"><a class="raw nav-el" href="search.html">Search</a></div></nav>
<body><header><div class="superheading"><div class="heading">
<h1 id="chapter_22">22. Advanced Phrases</h1>
<div class="subheading">Writing with Inform</div></div></div></header>
<main><section>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="raw nav-el" href="WI_21.html"><div class="nav-arrow">⬅21.</div><div class="doc-navbar-text">Lists</div></a></div><div class="doc-navbar-right"><a class="raw nav-el" href="WI_23.html"><div class="doc-navbar-text">Figures, Sounds and Files</div> <div class="nav-arrow">23.⮕</div></a></div></div>
<div class="section-block">
<div class="section-row">
<div class="section-chapter-num"><span class="sect-mark">§</span>22.</div><div class="section-section-num">1</div><div class="section-name-holder"><div class="section-name"><a href="WI_22.html#section_1">A review of kinds</a></div></div>
</div>
<div class="section-row">
<div class="section-chapter-num"><span class="sect-mark">§</span>22.</div><div class="section-section-num">2</div><div class="section-name-holder"><div class="section-name"><a href="WI_22.html#section_2">Descriptions as values</a></div></div>
</div>
<div class="section-row">
<div class="section-chapter-num"><span class="sect-mark">§</span>22.</div><div class="section-section-num">3</div><div class="section-name-holder"><div class="section-name"><a href="WI_22.html#section_3">Phrases as values</a></div></div>
</div>
<div class="section-row">
<div class="section-chapter-num"><span class="sect-mark">§</span>22.</div><div class="section-section-num">4</div><div class="section-name-holder"><div class="section-name"><a href="WI_22.html#section_4">Default values for phrase kinds</a></div></div>
</div>
<div class="section-row">
<div class="section-chapter-num"><span class="sect-mark">§</span>22.</div><div class="section-section-num">5</div><div class="section-name-holder"><div class="section-name"><a href="WI_22.html#section_5">Map, filter and reduce</a></div></div>
</div>
<div class="section-row">
<div class="section-chapter-num"><span class="sect-mark">§</span>22.</div><div class="section-section-num">6</div><div class="section-name-holder"><div class="section-name"><a href="WI_22.html#section_6">Generic phrases</a></div></div>
</div>
<div class="section-row">
<div class="section-chapter-num"><span class="sect-mark">§</span>22.</div><div class="section-section-num">7</div><div class="section-name-holder"><div class="section-name"><a href="WI_22.html#section_7">Kind variables</a></div></div>
</div>
<div class="section-row">
<div class="section-chapter-num"><span class="sect-mark">§</span>22.</div><div class="section-section-num">8</div><div class="section-name-holder"><div class="section-name"><a href="WI_22.html#section_8">Matching the names of kinds</a></div></div>
</div>
<div class="section-row">
<div class="section-chapter-num"><span class="sect-mark">§</span>22.</div><div class="section-section-num">9</div><div class="section-name-holder"><div class="section-name"><a href="WI_22.html#section_9">In what order?</a></div></div>
</div>
<div class="section-row">
<div class="section-chapter-num"><span class="sect-mark">§</span>22.</div><div class="section-section-num">10</div><div class="section-name-holder"><div class="section-name"><a href="WI_22.html#section_10">Ambiguities</a></div></div>
</div>
</div>
<article><h3 id="section_1">WI <span class="sect-mark">§</span>22.1 A review of kinds</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="raw nav-el" href="WI_21.html#section_11" title="Variations: arrays, logs, queues, stacks, sets, sieves and rings"><div class="nav-arrow"><span class="sym">⬅</span>21.11</div><div class="doc-navbar-text">Variations: arrays, logs, queues, stacks, sets, sieves and rings</div></a></div><div class="doc-navbar-center"><a class="raw nav-el" href="#chapter_22"><div class="nav-arrow"><span class="sym">⬆</span>22.</div><div class="doc-navbar-text">Advanced Phrases</div></a></div><div class="doc-navbar-right"><a class="raw nav-el" href="#section_2"><div class="doc-navbar-text">Descriptions as values</div><div class="nav-arrow">22.2<span class="sym">⮕</span></div></a></div></div></div>
<p>Most of the time, what&#39;s created in an Inform source text will have a name which can be used as a value &ndash; sometimes openly so, sometimes not. In this book, we haven&#39;t gone out of our way to make that point, because there was no real need to do so. It&#39;s possible to make heavy use of rulebooks and write large-scale Inform projects without ever needing to use a rulebook&#39;s name as a value in its own right, for example. But if we want to create sophisticated extensions to Inform, or to use modern techniques such as functional and generic programming, we need to be fluent in the language of kinds.</p>
<p>Inform&#39;s language of kinds has four ingredients: base kinds, constructions, kind variables and kinds of kinds.</p>
<p><strong>1. Base kinds.</strong> Inform provides the following base kinds for values:</p>
<div class="codeblock"><div class="codeline">object, number, real number, time, truth state, text, snippet, Unicode character, action, scene, table name, equation name, use option, action name, figure name, sound name, external file, rulebook outcome, parser error</div>
</div><p>together with a few others, such as &quot;response&quot; and &quot;verb&quot;, to do with linguistic features.</p>
<p>And Inform allows us to create new base kinds either by making more specialised kinds of object:</p>
<div class="codeblock"><div class="codeline">A geographical layout is a kind of object.</div>
<div class="codeline">A marmoset is a kind of animal.</div>
</div><p>Or by making new enumerations or arithmetical kinds:</p>
<div class="codeblock"><div class="codeline">Distance is a kind of value. 10km specifies a distance.</div>
<div class="codeline">Colour is a kind of value. Red, green and blue are colours.</div>
</div><p><strong>2. Constructions.</strong> These are ways to make new kinds from existing ones.  The construction most often used is &quot;list of&hellip;&quot;. For any kind K, there is a kind called list of K. So the range of possible kinds in Inform is actually infinite, because:</p>
<div class="codeblock"><div class="codeline">number</div>
<div class="codeline">list of numbers</div>
<div class="codeline">list of lists of numbers</div>
<div class="codeline">list of lists of lists of numbers</div>
<div class="codeline">...</div>
</div><p>are all different from each other. Inform has nine constructions, as follows:</p>
<div class="codeblock"><div class="codeline">list of K</div>
<div class="codeline">description of K</div>
<div class="codeline">relation of K to L</div>
<div class="codeline">K based rule producing L</div>
<div class="codeline">K based rulebook producing L</div>
<div class="codeline">activity on K</div>
<div class="codeline">phrase K -&gt; L</div>
<div class="codeline">K valued property</div>
<div class="codeline">K valued table column</div>
</div><p>Some of these have appeared in previous chapters, but in abbreviated form. For example, &quot;rulebook&quot; abbreviates &quot;action based rulebook producing nothing&quot;, and &quot;either/or property&quot; is a synonym for &quot;truth state valued property&quot;. The kinds of descriptions and phrases haven&#39;t been covered yet, but are coming up in the sections following.</p>
<p>These constructions can of course be combined:</p>
<div class="codeblock"><div class="codeline">phrase (relation of numbers to colours, number) -&gt; list of colours</div>
</div><p>Brackets can be used to clarify matters:</p>
<div class="codeblock"><div class="codeline">phrase (phrase number -&gt; (phrase number -&gt; number)) -&gt; nothing</div>
</div><p>Nothing will make that a simple idea, but it&#39;s unambiguous and can be puzzled out with practice.</p>
<p><strong>3. Variables.</strong> In a way, that&#39;s everything: there are just base kinds and constructions on them, and those construct every possible kind in Inform. But the language we use to describe kinds is larger than that, because it allows us to describe many kinds at once, in the same way that Inform reads the word &quot;something&quot; as applying to many objects at once, not as a single object.</p>
<p>Kind variables will be covered later in the chapter, but the idea is that:</p>
<div class="codeblock"><div class="codeline">To hunt for (needle - value of kind K) in (haystack - list of Ks): ...</div>
</div><p>allows us to describe the kinds acceptable in a phrase so that a wide range of possibilities are allowed. The above matches both:</p>
<div class="codeblock"><div class="codeline">hunt for 4 in { 2, 3, 4, 5 };</div>
<div class="codeline">hunt for &quot;fish&quot; in { &quot;lemon sauce&quot;, &quot;fish&quot;, &quot;garden peas&quot; };</div>
</div><p>The letter K in the definition stood for any kind; in the first use of &quot;hunt&quot; here, K turned out to be &quot;number&quot;, and in the second it was &quot;text&quot;. On the other hand Inform would reject:</p>
<div class="codeblock"><div class="codeline">hunt for 4 in { containment relation, support relation };</div>
</div><p>because there is no kind K which can make this match the definition.</p>
<p>There are potentially 26 kind variables, A to Z, though it&#39;s customary to use them in the order K, L, M, &hellip;, and it&#39;s very rare to need more than two at a time.</p>
<p><strong>4. Kinds of kind.</strong> Inform understands several names which look as if they are kinds, but actually aren&#39;t:</p>
<div class="codeblock"><div class="codeline">value, arithmetic value, enumerated value, sayable value</div>
</div><p>(Again, these are built in to Inform.) They are not kinds because they&#39;re just too loose and vague. Instead, they can be used in phrase definitions to match against multiple possibilities:</p>
<div class="codeblock"><div class="codeline">To announce (X - sayable value): say &quot;I declare that [X] has arrived.&quot;</div>
</div><p>This makes &quot;announce X&quot; work for any value X which can be said. All the same, &quot;sayable value&quot; is not a kind. It could never be safe for this to be the kind of a variable, because Inform would never know what could be done with the contents (except that it could be printed out).</p>
<p><strong>5. Secret inner workings.</strong> There isn&#39;t a fifth ingredient, but if there were, it would be a handful of names used in matching some of the core built-in phrases of Inform which have so-called inline <span class="sc">i</span>6 definitions. These are not intended for anyone else to use, and are just an internal convenience; they aren&#39;t publicly documented and might change without notice. They don&#39;t describe kinds at all, because they tell the matcher to look for something else instead. For instance, there&#39;s one called &quot;condition&quot;, which means &quot;match a condition rather than a value&quot;. They appear in red ink in the Phrasebook index.</p>
</article>
<article><h3 id="section_2">WI <span class="sect-mark">§</span>22.2 Descriptions as values</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="raw nav-el" href="#section_1" title="A review of kinds"><div class="nav-arrow"><span class="sym">⬅</span>22.1</div><div class="doc-navbar-text">A review of kinds</div></a></div><div class="doc-navbar-center"><a class="raw nav-el" href="#chapter_22"><div class="nav-arrow"><span class="sym">⬆</span>22.</div><div class="doc-navbar-text">Advanced Phrases</div></a></div><div class="doc-navbar-right"><a class="raw nav-el" href="#section_3"><div class="doc-navbar-text">Phrases as values</div><div class="nav-arrow">22.3<span class="sym">⮕</span></div></a></div></div></div>
<p>In the <a href="WI_6.html">chapter on Descriptions</a>, we saw that a description can be any source text which describes one or more objects: it might be as simple as &quot;the Corn Market&quot;, or as complicated as &quot;open containers which are in dark rooms&quot;. More or less the only restriction is that it must be unambiguous as to what counts and what does not: &quot;three containers&quot; is ambiguous as a description because it does not say which three.</p>
<p>We&#39;ve now seen several interesting tricks with descriptions. In fact, if D is a description, then</p>
<div class="codeblock"><div class="codeline">say &quot;You gaze mournfully at [the list of D].&quot;;</div>
<div class="codeline">let the tally be the number of D;</div>
<div class="codeline">let the surprise prize be a random D;</div>
<div class="codeline">repeat with item running through D:</div>
<div class="codeline">&ensp;&ensp;&ensp;...</div>
</div><p>are all standard things to do. These examples make it look as if it must be possible to define phrases which act on descriptions, and in fact it is, because a description can be a value in itself. For example,</p>
<div class="codeblock"><div class="codeline">even numbers</div>
<div class="codeline">open containers which are in dark rooms</div>
</div><p>are values of kind &quot;description of numbers&quot; and &quot;description of objects&quot; respectively. In general, if K is any kind then &quot;description of K&quot; is also a kind. Here is how we might make use of that:</p>
<div class="codeblock"><div class="codeline">To enumerate (collection - a description of objects):</div>
<div class="codeline">&ensp;&ensp;&ensp;repeat with the item running through the collection:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;say &quot;-- [The item].&quot;</div>
</div><p>This makes &quot;enumerate lighted rooms&quot; run off a list of lighted rooms in a textual format different from the standard one produced by &quot;say the list of lighted rooms&quot;. Inside the definition, &quot;collection&quot; can be used wherever a description might be used: here, for instance, we use it as the range for the repeat loop. (That&#39;s only possible because the range is limited in size: Inform wouldn&#39;t have allowed us to range through, say, all texts.)</p>
<p>Purely as a convenience, we can also write &quot;member of&quot; or &quot;members of&quot; in this context. For instance, in the enumerate definition, it would have been just as good to write &quot;&hellip;running through the members of the collection&hellip;&quot; in the repeat. (Similarly, we could write &quot;number of members of the collection&quot; or &quot;a random member of the collection&quot;, which looks grammatically tidier than writing &quot;number of the collection&quot; or &quot;random of the collection&quot; &ndash; though in fact both of these do work.)</p>
<p>Finally, it&#39;s sometimes useful in an abstract situation to test</p>
<div class="defn" id="ph_valuematch"><div class="defnline"><span class="defn">if </span><span class="neutral">(value)</span><span class="defn"> matches </span><span class="neutral">(description of values)</span><span class="defn">:</span></div><p>This condition is true if the value matches the description; the kinds must be compatible, or Inform will issue a problem message. There is no point using this for cases where the description is given explicitly:</p>
<div class="codeblock"><div class="codeline">if 4 matches even numbers, ...</div>
</div><p>because it is easier to write just:</p>
<div class="codeblock"><div class="codeline">if 4 is an even number, ...</div>
</div><p>So this condition is only useful when the description is stored in some variable, and its identity is not known.</p>
</div><div class="examples">
<h4>Example</h4>
<div class="example-short"><div class="example-short-num"><span class="hidden"></span>438.</div><div class="example-short-name"><span class="example-short-name"><a href="examples/curare.html">Curare</a></span> <span class="sym">★</span></div></div><div class="example-short"><div class="example-short-num"><span class="hidden">000.</span></div><div class="example-short-name">A phrase that chooses and names the least-recently selected item from the collection given, allowing the text to cycle semi-randomly through a group of objects.</div></div>
<div class="linkback"><a href="RB_2.html#section_1" title="Adaptive Prose &gt; Varying What Is Written">RB 2.1 Varying What Is Written</a></div>
</div>
</article>
<article><h3 id="section_3">WI <span class="sect-mark">§</span>22.3 Phrases as values</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="raw nav-el" href="#section_2" title="Descriptions as values"><div class="nav-arrow"><span class="sym">⬅</span>22.2</div><div class="doc-navbar-text">Descriptions as values</div></a></div><div class="doc-navbar-center"><a class="raw nav-el" href="#chapter_22"><div class="nav-arrow"><span class="sym">⬆</span>22.</div><div class="doc-navbar-text">Advanced Phrases</div></a></div><div class="doc-navbar-right"><a class="raw nav-el" href="#section_4"><div class="doc-navbar-text">Default values for phrase kinds</div><div class="nav-arrow">22.4<span class="sym">⮕</span></div></a></div></div></div>
<p>Given any two kinds K and L, the kind &quot;phrase K -&gt; L&quot; is now a kind. (This is meant to look like a mathematical function arrow.) For example, the phrase defined by</p>
<div class="codeblock"><div class="codeline">To decide which number is the square of (N - a number): ...</div>
</div><p>has the kind &quot;phrase number -&gt; number&quot;. Brackets and commas are used if the phrase combines several values, so</p>
<div class="codeblock"><div class="codeline">To decide which text is (T - text) repeated (N - a number) times: ...</div>
</div><p>has the kind &quot;phrase (text, number) -&gt; text&quot;. The word &quot;nothing&quot; is used if there are no values in, or no value out &ndash; thus</p>
<div class="codeblock"><div class="codeline">To decide which number is the magic target: ...</div>
</div><p>has kind &quot;phrase nothing -&gt; number&quot;, and</p>
<div class="codeblock"><div class="codeline">To dig (eastward - length) by (northward - length): ...</div>
</div><p>has the kind &quot;phrase (length, length) -&gt; nothing&quot;.</p>
<p>But how are we to get at these values? The answer is that we need to give a phrase a name in order to do so. For example:</p>
<div class="codeblock"><div class="codeline">To decide what number is double (N - a number) (this is doubling):</div>
<div class="codeline">&ensp;&ensp;&ensp;decide on N plus N.</div>
</div><p>This is the same syntax used to name rules, and the idea is the same. If we try &quot;showme doubling&quot;, the result is</p>
<div class="codeblock"><div class="codeline">phrase number -&gt; number: doubling</div>
</div><p>The main thing we want to do with a phrase is to apply it. So:</p>
<div class="codeblock"><div class="codeline">showme doubling applied to 2;</div>
</div><p>produces</p>
<div class="codeblock"><div class="codeline">&quot;doubling applied to 2&quot; = number: 4</div>
</div><p>There are versions of &quot;applied to&quot; for phrases applied to 0 to 3 values:</p>
<div class="defn" id="ph_applied0"><div class="defnline"><span class="neutral">(phrase nothing -> value)</span><span class="defn"> applied</span> &rArr; <em>value</em></div><p>This phrase produces the result of applying the given phrase, which must be one which takes no values itself.</p>
</div><div class="defn" id="ph_applied1"><div class="defnline"><span class="neutral">(phrase value -> value)</span><span class="defn"> applied to </span><span class="neutral">(value)</span> &rArr; <em>value</em></div><p>This phrase produces the result of applying the given phrase, which must be one which takes one value itself.</p>
</div><div class="defn" id="ph_applied2"><div class="defnline"><span class="neutral">(phrase </span><span class="neutral">(value, value) -> value)</span><span class="defn"> applied to </span><span class="neutral">(value)</span><span class="defn"> and </span><span class="neutral">(value)</span> &rArr; <em>value</em></div><p>This phrase produces the result of applying the given phrase, which must be one which takes two values itself.</p>
</div><div class="defn" id="ph_applied3"><div class="defnline"><span class="neutral">(phrase </span><span class="neutral">(value, value, value) -> value)</span><span class="defn"> applied to </span><span class="neutral">(value)</span><span class="defn"> and </span><span class="neutral">(value)</span><span class="defn"> and </span><span class="neutral">(value)</span> &rArr; <em>value</em></div><p>This phrase produces the result of applying the given phrase, which must be one which takes three values itself.</p>
</div><p>So for example:</p>
<div class="codeblock"><div class="codeline">F applied</div>
<div class="codeline">F applied to V</div>
<div class="codeline">F applied to V and W</div>
<div class="codeline">F applied to V and W and X</div>
</div><p>For phrases which do not produce a value, we use &quot;apply&quot;:</p>
<div class="defn" id="ph_apply0"><div class="defnline"><span class="defn">apply </span><span class="neutral">(phrase nothing -> nothing)</span></div><p>This phrase causes the given phrase to be applied. It must be one which takes no values itself.</p>
</div><div class="defn" id="ph_apply1"><div class="defnline"><span class="defn">apply </span><span class="neutral">(phrase value -> nothing)</span><span class="defn"> to </span><span class="neutral">(value)</span></div><p>This phrase causes the given phrase to be applied. It must be one which takes one value itself.</p>
</div><div class="defn" id="ph_apply2"><div class="defnline"><span class="defn">apply </span><span class="neutral">(phrase </span><span class="neutral">(value, value) -> nothing)</span><span class="defn"> to </span><span class="neutral">(value)</span><span class="defn"> and </span><span class="neutral">(value)</span></div><p>This phrase causes the given phrase to be applied. It must be one which takes two values itself.</p>
</div><div class="defn" id="ph_apply3"><div class="defnline"><span class="defn">apply </span><span class="neutral">(phrase </span><span class="neutral">(value, value, value) -> nothing)</span><span class="defn"> to </span><span class="neutral">(value)</span><span class="defn"> and </span><span class="neutral">(value)</span><span class="defn"> and </span><span class="neutral">(value)</span></div><p>This phrase causes the given phrase to be applied. It must be one which takes three values itself.</p>
</div><p>Thus:</p>
<div class="codeblock"><div class="codeline">apply F;</div>
<div class="codeline">apply F to V;</div>
<div class="codeline">apply F to V and W;</div>
<div class="codeline">apply F to V and W and X;</div>
</div></article>
<article><h3 id="section_4">WI <span class="sect-mark">§</span>22.4 Default values for phrase kinds</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="raw nav-el" href="#section_3" title="Phrases as values"><div class="nav-arrow"><span class="sym">⬅</span>22.3</div><div class="doc-navbar-text">Phrases as values</div></a></div><div class="doc-navbar-center"><a class="raw nav-el" href="#chapter_22"><div class="nav-arrow"><span class="sym">⬆</span>22.</div><div class="doc-navbar-text">Advanced Phrases</div></a></div><div class="doc-navbar-right"><a class="raw nav-el" href="#section_5"><div class="doc-navbar-text">Map, filter and reduce</div><div class="nav-arrow">22.5<span class="sym">⮕</span></div></a></div></div></div>
<p>The default value for &quot;phrase K -&gt; nothing&quot; is a phrase which does nothing. For example, if we write:</p>
<div class="codeblock"><div class="codeline">let S be a phrase numbers -&gt; nothing;</div>
</div><p>then S is created holding the default phrase numbers -&gt; nothing, and if we then try it out with:</p>
<div class="codeblock"><div class="codeline">apply S to 17;</div>
</div><p>we will indeed find that nothing happens.</p>
<p>The default value for &quot;phrase K -&gt; L&quot; is a phrase which, no matter what value of K it applies to, always produces the default value of L. (It&#39;s a sort of equivalent of the zero function in mathematics &ndash; indeed that&#39;s exactly what it is, if L is &quot;number&quot;.) So:</p>
<div class="codeblock"><div class="codeline">let Q be a phrase numbers -&gt; times;</div>
<div class="codeline">showme Q;</div>
<div class="codeline">showme Q applied to 4;</div>
<div class="codeline">showme Q applied to -7;</div>
</div><p>produces:</p>
<div class="codeblock"><div class="codeline">&quot;q&quot; = phrase number -&gt; time: default value of phrase number -&gt; time</div>
<div class="codeline">&quot;q applied to 4&quot; = time: 9:00 am</div>
<div class="codeline">&quot;q applied to -7&quot; = time: 9:00 am</div>
</div><p>Here Q is set to the default phrase because we didn&#39;t give it any other value; it has the name we might expect (&quot;default value of phrase number -&gt; time&quot;) and it works as advertised, producing 9:00 am no matter what number is fed in.</p>
<p>More ambitiously, and supposing that we have a kind called &quot;colour&quot; whose first possible value is &quot;red&quot;:</p>
<div class="codeblock"><div class="codeline">let R be a phrase numbers -&gt; (phrase numbers -&gt; colours);</div>
<div class="codeline">showme R;</div>
<div class="codeline">showme R applied to 3;</div>
<div class="codeline">showme (R applied to 3) applied to 2;</div>
</div><p>produces:</p>
<div class="codeblock"><div class="codeline">&quot;r&quot; = phrase number -&gt; (phrase number -&gt; colour): default value of phrase</div>
<div class="codeline">number -&gt; (phrase number -&gt; colour)</div>
<div class="codeline">&quot;r applied to 3&quot; = phrase number -&gt; colour: default value of phrase number</div>
<div class="codeline">-&gt; colour</div>
<div class="codeline">&quot;( r applied to 3 ) applied to 2&quot; = colour: red</div>
</div></article>
<article><h3 id="section_5">WI <span class="sect-mark">§</span>22.5 Map, filter and reduce</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="raw nav-el" href="#section_4" title="Default values for phrase kinds"><div class="nav-arrow"><span class="sym">⬅</span>22.4</div><div class="doc-navbar-text">Default values for phrase kinds</div></a></div><div class="doc-navbar-center"><a class="raw nav-el" href="#chapter_22"><div class="nav-arrow"><span class="sym">⬆</span>22.</div><div class="doc-navbar-text">Advanced Phrases</div></a></div><div class="doc-navbar-right"><a class="raw nav-el" href="#section_6"><div class="doc-navbar-text">Generic phrases</div><div class="nav-arrow">22.6<span class="sym">⮕</span></div></a></div></div></div>
<p>When a mass of computations has to be done, the traditional approach is to work through them in a &quot;repeat&quot; loop. One modern alternative, growing in popularity, is to form a list of inputs; then apply the same computation to each input in turn to form a list of results (this is called &quot;mapping&quot;); throw out any bad or unwanted results (&quot;filtering&quot;); and then combine the surviving results into a single composite answer (&quot;reducing&quot;, though some programming languages call this &quot;folding&quot; or &quot;accumulation&quot;; it&#39;s a much-reinvented idea).</p>
<p>Inform provides all three of these fundamental list-processing operations. There is no special term for a &quot;map&quot;, because Inform treats it as another case of &quot;applied to&quot;.</p>
<div class="defn" id="ph_appliedlist"><div class="defnline"><span class="neutral">(phrase value -> value)</span><span class="defn"> applied to </span><span class="neutral">(list of values)</span> &rArr; <em>value</em></div><p>This phrase takes the list, applies the phrase to each entry in the list, and forms a new list of the result. Example:</p>
<div class="codeblock"><div class="codeline">To decide what number is double (N - a number) (this is doubling):</div>
<div class="codeline">&ensp;&ensp;&ensp;decide on N plus N.</div>
</div><p>Then &quot;doubling applied to 2&quot; produces 4, by the simpler definition of &quot;applied to&quot;, but also:</p>
<div class="codeblock"><div class="codeline">doubling applied to {2, 3, 4}</div>
</div><p>produces the list {4, 6, 8}.</p>
</div><p>More divertingly, suppose we define:</p>
<div class="codeblock"><div class="codeline">To decide what text is the longhand form of (N - a number)</div>
<div class="codeline">&ensp;&ensp;&ensp;(this is spelling out):</div>
<div class="codeline">&ensp;&ensp;&ensp;decide on &quot;[N in words]&quot;.</div>
<div class="codeline blankline">&thinsp;</div>
<div class="codeline">To decide what text is the consonant form of (T - text)</div>
<div class="codeline">&ensp;&ensp;&ensp;(this is txtng):</div>
<div class="codeline">&ensp;&ensp;&ensp;replace the regular expression &quot;&lt;aeiou&gt;&quot; in T with &quot;&quot;;</div>
<div class="codeline">&ensp;&ensp;&ensp;decide on T.</div>
</div><p>Then we can write a chain of three maps in succession:</p>
<div class="codeblock"><div class="codeline">txtng applied to spelling out applied to doubling applied to {3, 8, 4, 19, 7}</div>
</div><p>to produce the value {&quot;sx&quot;, &quot;sxtn&quot;, &quot;ght&quot;, &quot;thrty-ght&quot;, &quot;frtn&quot;}.</p>
<p>Next, filtering. Here we make use of descriptions, in order to say what values will be allowed through the filter. So:</p>
<div class="defn" id="ph_filter"><div class="defnline"><span class="defn">filter to </span><span class="neutral">(description of values)</span><span class="defn"> of </span><span class="neutral">(list of values)</span> &rArr; <em>value</em></div><p>This phrase produces a new list which is a thinner version of the one given, so that it contains only those values which match the description given. Example:</p>
<div class="codeblock"><div class="codeline">filter to even numbers of {3, 8, 4, 19, 7}</div>
</div><p>produces {8, 4}, with the values 3, 19, and 7 failing to make it through. A sufficiently fine filter may well thin out a list to a single entry, or even no entries at all, but the result is always a list.</p>
</div><p>To get the full effect of filtering, we probably need to define an adjective or two. For example:</p>
<div class="codeblock"><div class="codeline">Definition: a text (called T) is lengthy if the number of characters in it is greater than 6.</div>
</div><p>We can then write, for example:</p>
<div class="codeblock"><div class="codeline">let L be the filter to lengthy texts of spelling out applied to {15, 2, 20, 29, -4};</div>
<div class="codeline">showme L;</div>
</div><p>which produces the list {&quot;fifteen&quot;, &quot;twenty-nine&quot;, &quot;minus four&quot;}.</p>
<p>Lastly, reduction. In order to combine a whole list of values, we need a phrase to combine any two. Here are some samples:</p>
<div class="codeblock"><div class="codeline">To decide what number is the larger of (N - number) and (M - number)</div>
<div class="codeline">&ensp;&ensp;&ensp;(this is maximization):</div>
<div class="codeline">&ensp;&ensp;&ensp;if N &gt; M, decide on N;</div>
<div class="codeline">&ensp;&ensp;&ensp;decide on M.</div>
<div class="codeline blankline">&thinsp;</div>
<div class="codeline">To decide what text is the concatenation of (X - text) and (Y - text)</div>
<div class="codeline">&ensp;&ensp;&ensp;(this is concatenation):</div>
<div class="codeline">&ensp;&ensp;&ensp;decide on &quot;[X][Y]&quot;.</div>
</div><p>And here are some sample reductions:</p>
<div class="codeblock"><div class="codeline">let X be the maximization reduction of {3, 8, 4, 19, 7};</div>
<div class="codeline">let Y be the concatenation reduction of txtng applied to spelling out</div>
<div class="codeline">&ensp;&ensp;&ensp;applied to doubling applied to {3, 8, 4, 19, 7};</div>
</div><p>sets X to 19, the highest of the values, and Y to the text &quot;sxsxtnghtthrty-ghtfrtn&quot;. In each case a list has been reduced to a single value which somehow combines the contents.</p>
<div class="defn" id="ph_reduction"><div class="defnline"><span class="neutral">(phrase </span><span class="neutral">(value, value) -> value)</span><span class="defn"> reduction of </span><span class="neutral">(list of values)</span> &rArr; <em>value</em></div><p>This phrase works through the list and accumulates the values in it, using the phrase supplied. Example: if we have</p>
<div class="codeblock"><div class="codeline">To decide what number is the sum of (N - number) and (M - number)</div>
<div class="codeline">&ensp;&ensp;&ensp;(this is summing):</div>
<div class="codeline">&ensp;&ensp;&ensp;decide on N + M.</div>
</div><p>then the summing reduction of {3, 8, 4, 19, 7} is the number 41, obtained by</p>
<div class="codeblock"><div class="codeline">(((3 + 8) + 4) + 19) + 7</div>
</div><p>so that the summing phrase has been used four times.</p>
</div><p>Is map/filter/reduce always a good idea? Devotees point out that almost any computation can be thought of in this way, and in systems where the work has to be distributed around multiple processors it can be a very powerful tool. (There are programming languages without loops where it&#39;s essentially the only tool.) At its best, it reads very elegantly: one assembles all of the tools needed &ndash; definitions of doubling, lengthy, spelling out, concatenation and so on &ndash; and then each actual task is expressed in a single line at the end.</p>
<p>On the other hand, there are also times when this is a needlessly complicated disguise for what could more easily be done with a &quot;repeat&quot; loop, and also more efficiently since assembling and dismantling lists in memory does take some overhead time. So these list operations are not a panacea, but it&#39;s good to have them available.</p>
</article>
<article><h3 id="section_6">WI <span class="sect-mark">§</span>22.6 Generic phrases</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="raw nav-el" href="#section_5" title="Map, filter and reduce"><div class="nav-arrow"><span class="sym">⬅</span>22.5</div><div class="doc-navbar-text">Map, filter and reduce</div></a></div><div class="doc-navbar-center"><a class="raw nav-el" href="#chapter_22"><div class="nav-arrow"><span class="sym">⬆</span>22.</div><div class="doc-navbar-text">Advanced Phrases</div></a></div><div class="doc-navbar-right"><a class="raw nav-el" href="#section_7"><div class="doc-navbar-text">Kind variables</div><div class="nav-arrow">22.7<span class="sym">⮕</span></div></a></div></div></div>
<p>The following looks quite innocent:</p>
<div class="codeblock"><div class="codeline">To say (V - value) twice: say &quot;[V]. [V], I say!&quot;</div>
</div><p>It&#39;s clear at a glance what this is intended to do, but at a second glance things aren&#39;t so straightforward. &quot;Value&quot; is not itself a kind &ndash; it&#39;s too big and unspecific. For instance, if we were to allow a variable to be just &quot;a value&quot;, we could freely set it to 12 one minute and to &quot;dahlias&quot; the next, and such a variable would be dangerous since we would never know what could safely be done with its contents. A phrase like this one is called &quot;generic&quot;, because it&#39;s not so much a single, actual phrase as a recipe to make phrases. (Inform automatically works out which kinds we need the phrase for, and creates a version of the phrase for those kinds.)</p>
<p>So &quot;value&quot; is not a kind, but a kind of kind. Inform has several of these:</p>
<div class="codeblock"><div class="codeline">value, arithmetic value, enumerated value, sayable value</div>
</div><p>These act as ways to say &quot;a value of any kind matching this can go here&quot;. For example, &quot;value&quot; is a way to say &quot;any kind at all&quot;; &quot;arithmetic value&quot; is any kind which arithmetic can be performed on (any kind with the little calculator icon in the Arithmetic part of the Kinds index); and so on. If we write:</p>
<div class="codeblock"><div class="codeline">To double (V - arithmetic value): say &quot;[V times 2].&quot;</div>
</div><p>the restriction to &quot;arithmetic value&quot; means that although &quot;double 3&quot;, &quot;double 6 kg&quot;, etc., would be matched, &quot;double the Entire Game&quot; would not &ndash; you can&#39;t perform arithmetic on scenes. Similarly, it would have been tidier to write:</p>
<div class="codeblock"><div class="codeline">To say (V - sayable value) twice: say &quot;[V]. [V], I say!&quot;</div>
</div><p>because then Inform will make it clearer why &quot;say X twice&quot; won&#39;t work if X is one of those rare values which it can&#39;t say (an activity, for instance).</p>
<p>The Kinds index shows which kinds match against which of these &quot;kinds of kind&quot;. For instance, it shows that &quot;time&quot;</p>
<div class="codeblock"><div class="codeline">Matches: value, arithmetic value, sayable value</div>
</div><p>which means that time is something we can do arithmetic on, and can say.</p>
</article>
<article><h3 id="section_7">WI <span class="sect-mark">§</span>22.7 Kind variables</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="raw nav-el" href="#section_6" title="Generic phrases"><div class="nav-arrow"><span class="sym">⬅</span>22.6</div><div class="doc-navbar-text">Generic phrases</div></a></div><div class="doc-navbar-center"><a class="raw nav-el" href="#chapter_22"><div class="nav-arrow"><span class="sym">⬆</span>22.</div><div class="doc-navbar-text">Advanced Phrases</div></a></div><div class="doc-navbar-right"><a class="raw nav-el" href="#section_8"><div class="doc-navbar-text">Matching the names of kinds</div><div class="nav-arrow">22.8<span class="sym">⮕</span></div></a></div></div></div>
<p>The examples of generic phrases in the previous section were really only toy examples. Suppose we want a phrase which will take any arithmetic value and triple it. We could do something like this:</p>
<div class="codeblock"><div class="codeline">To triple (V - arithmetic value): say &quot;[V times 3].&quot;</div>
</div><p>But this only prints the answer. Suppose we want to be given the value back, instead: how can we write the phrase? The trouble is that, not knowing the kind of V, we can&#39;t say what kind will be produced. We need a way of saying &quot;the same kind comes out as went in&quot;. Inform expresses that using kind variables:</p>
<div class="codeblock"><div class="codeline">To decide which K is triple (original - arithmetic value of kind K):</div>
<div class="codeline">&ensp;&ensp;&ensp;decide on 3 times the original.</div>
</div><p>Here, K stands for any kind which matches &quot;arithmetic value&quot;. Inform supports exactly 26 of these symbols, which are written A to Z, but it&#39;s customary to use K and L. (They can be written in the plural if we like: e.g., &quot;list of Ks&quot;. But they must always use a capital letter: &quot;list of k&quot; is not allowed.)</p>
<p>Each symbol we use has to be declared in exactly one of the bracketed ingredients for the phrase &ndash; here, the declaration is &quot;arithmetic value of kind K&quot;. That creates K and says that it has to be arithmetic; if we&#39;d just said &quot;value of kind K&quot;, it could have been anything. (Alternatively, we could use any of the kinds of kind in the previous section.)</p>
<p>For a more ambitious example, here is one way to define the mapping operation described earlier in the chapter:</p>
<div class="codeblock"><div class="codeline">To decide what list of L is (function - phrase K -&gt; value of kind L)</div>
<div class="codeline">&ensp;&ensp;&ensp;applied to (original list - list of values of kind K):</div>
<div class="codeline">&ensp;&ensp;&ensp;let the result be a list of Ls;</div>
<div class="codeline">&ensp;&ensp;&ensp;repeat with item running through the original list:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;let the mapped item be the function applied to the item;</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;add the mapped item to the result;</div>
<div class="codeline">&ensp;&ensp;&ensp;decide on the result.</div>
</div><p>Here we need two symbols to explain the complicated way that the values going in and out have to match up to each other. Note also the way that the temporary variable &quot;result&quot; is created:</p>
<div class="codeblock"><div class="codeline">let the result be a list of Ls;</div>
</div><p>Ordinarily, of course, &quot;L&quot; is not a kind. But within the body of a phrase definition, it means whatever kind L matched against.</p>
<p>When a symbol occurs several times in the same definition, subtle differences can arise according to which appearance is the declaration. These are not quite the same:</p>
<div class="codeblock"><div class="codeline">To hunt for (V - value of kind K) in (L - list of Ks): ...</div>
<div class="codeline">To hunt for (V - K) in (L - list of values of kind K): ...</div>
</div><p>The difference arises &ndash; though very rarely &ndash; if V has some different kind compared to the list entries, but which can be used as if it were of that kind. For example,</p>
<div class="codeblock"><div class="codeline">hunt for the player&#39;s command in {&quot;take all&quot;, &quot;wait&quot;};</div>
</div><p>Here V is a snippet, but L is a list of texts; and a snippet can be used in place of a text, but not vice versa. So this will match the second definition, because K is set to &quot;text&quot;, but it won&#39;t match the first, where K is set to &quot;snippet&quot;.</p>
</article>
<article><h3 id="section_8">WI <span class="sect-mark">§</span>22.8 Matching the names of kinds</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="raw nav-el" href="#section_7" title="Kind variables"><div class="nav-arrow"><span class="sym">⬅</span>22.7</div><div class="doc-navbar-text">Kind variables</div></a></div><div class="doc-navbar-center"><a class="raw nav-el" href="#chapter_22"><div class="nav-arrow"><span class="sym">⬆</span>22.</div><div class="doc-navbar-text">Advanced Phrases</div></a></div><div class="doc-navbar-right"><a class="raw nav-el" href="#section_9"><div class="doc-navbar-text">In what order?</div><div class="nav-arrow">22.9<span class="sym">⮕</span></div></a></div></div></div>
<p>Sometimes a phrase needs to know what kind it&#39;s to work on, but isn&#39;t going to be given any particular value of it. For example:</p>
<div class="codeblock"><div class="codeline">To assay (name of kind of value K):</div>
<div class="codeline">&ensp;&ensp;&ensp;repeat with item running through Ks:</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;say &quot;There&#39;s [item].&quot;;</div>
<div class="codeline">&ensp;&ensp;&ensp;say &quot;But the default is [default value of K].&quot;;</div>
</div><p>Note that there&#39;s no hyphen, and no name for the bracketed token &ndash; it only sets K. We can then have, say:</p>
<div class="codeblock"><div class="codeline">assay colours;</div>
<div class="codeline">assay vehicles;</div>
</div><p>But &quot;assay texts&quot; would throw a problem message, because we can&#39;t repeat through all possible texts. For a different reason,</p>
<div class="codeblock"><div class="codeline">assay open doors;</div>
</div><p>would not be allowed &ndash; &quot;open doors&quot; is a description which applies to some doors and not others; it isn&#39;t a kind. It would make no sense to talk about &quot;default value of open door&quot;, for example.</p>
</article>
<article><h3 id="section_9">WI <span class="sect-mark">§</span>22.9 In what order?</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="raw nav-el" href="#section_8" title="Matching the names of kinds"><div class="nav-arrow"><span class="sym">⬅</span>22.8</div><div class="doc-navbar-text">Matching the names of kinds</div></a></div><div class="doc-navbar-center"><a class="raw nav-el" href="#chapter_22"><div class="nav-arrow"><span class="sym">⬆</span>22.</div><div class="doc-navbar-text">Advanced Phrases</div></a></div><div class="doc-navbar-right"><a class="raw nav-el" href="#section_10"><div class="doc-navbar-text">Ambiguities</div><div class="nav-arrow">22.10<span class="sym">⮕</span></div></a></div></div></div>
<p>Recall the definition:</p>
<div class="codeblock"><div class="codeline">To slam shut (box - an open container): say &quot;With great panache, you slam shut [the box].&quot;.</div>
</div><p>Suppose we then try to &quot;slam shut the wall safe&quot; at a time during play when the wall safe is already closed. An error message will then be printed during play, since there must be a mistake in the design. The combination of checking both when Inform builds the story file and then continuously when the story file is played guarantees that, in all cases, a varying item such as &quot;box&quot; in the definition of &quot;To slam shut (box &ndash; open container)&quot; always satisfies the condition laid down.</p>
<p>Instead suppose we also have the following definition:</p>
<div class="codeblock"><div class="codeline">To slam shut (box - a container): say &quot;You are unable to slam shut [the box], which is already closed.&quot;.</div>
</div><p>We now have two definitions of &quot;slam shut&quot;. Sometimes the box it&#39;s applied to will be closed, in which case only the second definition fits, and will be the one used. But if the box is open, both definitions fit. Which will happen? The rule is:</p>
<div class="codeblock"><div class="codeline">1. A narrower condition takes precedence over a broader one;</div>
<div class="codeline blankline">&thinsp;</div>
<div class="codeline">2. If neither condition is narrower than the other, then whichever phrase was defined later in the source code is the one taking precedence;</div>
<div class="codeline blankline">&thinsp;</div>
<div class="codeline">3. Except that if the phrase is being used in the definition of phrase P, then P is always last in precedence order, so that recursion is always the very last possibility considered. This allows more specific or later definitions to make use of less specific or earlier ones in a natural way.</div>
</div><p>Rule 1 ensures that a definition involving &quot;open container&quot; takes priority over one which merely involves &quot;container&quot;, for instance.</p>
<p>And therefore when the box is open, it&#39;s the more specific phrase to do with open containers which is invoked: so, with great panache, the box is slammed shut.</p>
<p>On the other hand, neither of these patterns is narrower than the other:</p>
<div class="codeblock"><div class="codeline">To describe (something - transparent): ...</div>
<div class="codeline">To describe (something - container): ...</div>
</div><p>Some containers are transparent, some not; some transparent things are containers, some not. Rule 1 therefore does not apply, so it is the later of the two phrases which takes effect.</p>
</article>
<article><h3 id="section_10">WI <span class="sect-mark">§</span>22.10 Ambiguities</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="raw nav-el" href="#section_9" title="In what order?"><div class="nav-arrow"><span class="sym">⬅</span>22.9</div><div class="doc-navbar-text">In what order?</div></a></div><div class="doc-navbar-center"><a class="raw nav-el" href="#chapter_22"><div class="nav-arrow"><span class="sym">⬆</span>22.</div><div class="doc-navbar-text">Advanced Phrases</div></a></div><div class="doc-navbar-right"><a class="raw nav-el" href="WI_23.html" title="Figures, Sounds and Files"><div class="doc-navbar-text">Figures, Sounds and Files</div><div class="nav-arrow">23.<span class="sym">⮕</span></div></a></div></div></div>
<p>Another possible ambiguity occurs when a phrase might match two lexically different possibilities using the same words.</p>
<div class="codeblock"><div class="codeline">say the dishcloth;</div>
</div><p>could be construed as a usage of either of these cases:</p>
<div class="codeblock"><div class="codeline">say the (something - a thing)</div>
<div class="codeline">say (something - a thing)</div>
</div><p>These of course have different effects &ndash; one produces the name with a definite article, the other just the name, so the difference is important.</p>
<p>The rule here is that whichever possibility contains the most words, in this case &quot;say the (&hellip;)&quot;, takes precedence, because it&#39;s assumed to be a more specific form of the less wordy version.</p>
</article>
</section></main>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="raw nav-el" href="WI_21.html"><div class="nav-arrow">⬅21.</div><div class="doc-navbar-text">Lists</div></a></div><div class="doc-navbar-right"><a class="raw nav-el" href="WI_23.html"><div class="doc-navbar-text">Figures, Sounds and Files</div> <div class="nav-arrow">23.⮕</div></a></div></div>
<footer id="credits-footer"><nav><div class="nav-el"><a class="raw nav-el" href="index.html">Contents</a></div><div class="nav-el"><a class="raw nav-el" href="examples/index.html">Examples</a></div><div class="nav-el"><a class="raw nav-el" href="general_index.html">Index</a></div><div class="nav-el"><a class="raw nav-el" href="search.html">Search</a></div></nav>
<div class="footing"><p id="i7credit"><a href="http://inform7.com">Inform 7</a> and its documentation are &copy; 2006-<span id="current_year">2022</span> by Graham Nelson and published under the <a href="license.html">Artistic License 2.0</a>.</p><p class="about"><a class="raw" href="about.html">About this edition</a>&ensp;&bull;&ensp;<a class="raw" href="https://twitter.com/inform7tips">@inform7tips</a></p></div></footer>
</body></html>
