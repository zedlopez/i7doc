<!doctype html>
<html lang="en"><head><meta charset="utf-8">
<title>WI 27. Extensions</title>
<script src="i7doc.js"></script>
<link rel="stylesheet" href="i7doc.css">
</head>
<nav><div class="nav-el"><a class="nav-el" href="index.html">Contents</a></div><div class="nav-el"><a class="nav-el" href="examples/index.html">Examples</a></div><div class="nav-el"><a class="nav-el" href="general_index.html">Index</a></div><div class="nav-el"><a class="nav-el" href="search.html">Search</a></div></nav>
<body><header><div class="superheading"><div class="heading">
<h1 id="chapter_27">27. Extensions</h1>
<div class="subheading">Writing with Inform</div></div></div></header>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="WI_26.html"><div class="nav-arrow">←</div> <div class="doc-navbar-text">26. Publishing</div></a></div><div class="doc-navbar-center"><div class="nav-el"><span class="hidden">0</span></div></div><div class="doc-navbar-right"><a class="nav-el" href="RB_1.html" title="How to Use The Recipe Book"><div class="doc-navbar-text">How to Use The Recipe Book</div><div class="nav-arrow">RB 1.→</div></a></div></div></div>
<div class="section-block">
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">1</div><div class="section-name"><a href="WI_27.html#section_1">The status of extensions</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">2</div><div class="section-name"><a href="WI_27.html#section_2">The Standard Rules</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">3</div><div class="section-name"><a href="WI_27.html#section_3">Built-in, installed and project-specific extensions</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">4</div><div class="section-name"><a href="WI_27.html#section_4">Authorship</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">5</div><div class="section-name"><a href="WI_27.html#section_5">A simple example extension</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">6</div><div class="section-name"><a href="WI_27.html#section_6">Version numbering</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">7</div><div class="section-name"><a href="WI_27.html#section_7">Extensions and story file formats</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">8</div><div class="section-name"><a href="WI_27.html#section_8">Extensions can include other extensions</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">9</div><div class="section-name"><a href="WI_27.html#section_9">Extensions can interact with other extensions</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">10</div><div class="section-name"><a href="WI_27.html#section_10">Extensions in the Index</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">11</div><div class="section-name"><a href="WI_27.html#section_11">Extension documentation</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">12</div><div class="section-name"><a href="WI_27.html#section_12">Examples and headings in extension documentation</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">13</div><div class="section-name"><a href="WI_27.html#section_13">Implications</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">14</div><div class="section-name"><a href="WI_27.html#section_14">Using Inform 6 within Inform 7</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">15</div><div class="section-name"><a href="WI_27.html#section_15">Defining phrases in Inform 6</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">16</div><div class="section-name"><a href="WI_27.html#section_16">Phrases to decide in Inform 6</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">17</div><div class="section-name"><a href="WI_27.html#section_17">Handling phrase options</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">18</div><div class="section-name"><a href="WI_27.html#section_18">Making and testing use options</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">19</div><div class="section-name"><a href="WI_27.html#section_19">Longer extracts of Inform 6 code</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">20</div><div class="section-name"><a href="WI_27.html#section_20">Primitive Inform 6 declarations of rules</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">21</div><div class="section-name"><a href="WI_27.html#section_21">Inform 6 objects and classes</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">22</div><div class="section-name"><a href="WI_27.html#section_22">Inform 6 variables, properties, actions, and attributes</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">23</div><div class="section-name"><a href="WI_27.html#section_23">Inform 6 Understand tokens</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">24</div><div class="section-name"><a href="WI_27.html#section_24">Inform 6 adjectives</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">25</div><div class="section-name"><a href="WI_27.html#section_25">Naming Unicode characters</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">26</div><div class="section-name"><a href="WI_27.html#section_26">Overriding definitions in kits</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">27</div><div class="section-name"><a href="WI_27.html#section_27">Translating the language of play</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">28</div><div class="section-name"><a href="WI_27.html#section_28">Segmented substitutions</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">29</div><div class="section-name"><a href="WI_27.html#section_29">Invocation labels, counters and storage</a></div>
</div>
<div class="section-row">
<div class="section-chapter-num">§27.</div><div class="section-section-num">30</div><div class="section-name"><a href="WI_27.html#section_30">To say one of</a></div>
</div>
</div>
<h3 id="section_1">WI §27.1 The status of extensions</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="WI_26.html#section_8" title="A short concluding homily"><div class="nav-arrow">←26.8 </div><div class="doc-navbar-text">A short concluding homily</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_2"><div class="doc-navbar-text">The Standard Rules</div><div class="nav-arrow">27.2→</div></a></div></div></div>
<p>The range of simulation offered by Inform&#39;s model world is intentionally limited to a core of basic essentials. We could argue at the margins, and the choice of what&#39;s in and what&#39;s out is partly traditional, but most people find the model reasonable as far as it goes.</p>
<p>Between 1993 and 2006, quite a range of &quot;library extensions&quot; for Inform&#39;s predecessor language (Inform 6) was written. Most of these extensions aimed to fill out the model by simulating other aspects of life, too: money, clothing, pourable liquids. None of these extensions was official and all of them were: it was a free-for-all, and in several cases different authors wrote rival extensions to model the same basic ideas. The development of Inform 7 was strongly influenced by this history and by the recognition that the base of rules and grammar inside a typical modern story are seldom written by a single author. They combine the standard Inform material with extensions by several third parties, together with anything specific to the story in question.</p>
<p>Inform 7 has a more organised idea of extensions, as we shall see. But anyone is free to write an extension on any terms or for any reason. Writers may wish to use the techniques in this chapter to develop private extensions of their own, used in several projects, or to share them with associates but not more widely.</p>
<p>But most writers of extensions do so to contribute to the Inform community, and for the satisfaction of solving a problem. Inform does not recognise anyone&#39;s approach to a particular need as &quot;the official solution&quot; &ndash; for instance, although the standard Inform distribution includes a copy of Locksmith by Emily Short, that is not the &quot;official&quot; way to make automatically unlocking doors, and anyone is welcome to try a better one.</p>
<p>However, the Inform project does recognise some extensions as &quot;public&quot;. Public extensions are the ones archived on the Inform website for the free use of all Inform writers. Those who wish to contribute an extension as a public one are obliged to follow a number of guidelines, which are mostly stylistic points intended to make the range of extensions easier to work with. Extension writers are asked to join in the spirit of these rules and help make the whole cooperative enterprise work harmoniously. Extensions which do play by these rules are also accepted into the Public Library, which makes them easy for all Inform users everywhere to find and obtain them.</p>
<p>Writers who wish to make their extensions public on the Inform website should also be clear that by doing so, they are donating their work to the community on the basis of the broadest form of Creative Commons license: that is, they retain copyright and the right to be identified as the author (and as we shall see they are automatically credited in any work of IF which uses their extension), but are giving unlimited permission to use, circulate and republish their extensions in any form, even as part of commercial works (should that arise). To publish a public extension is a public-spirited act, done for only the reward of a modest acknowledgement.</p>
<p>If the author of an extension has not made it public, or indicated in some other way that it is free to be used without the need for permission, then it would be both polite and prudent to check with the author before publishing something which incorporates his work.</p>
<h3 id="section_2">WI §27.2 The Standard Rules</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_1" title="The status of extensions"><div class="nav-arrow">←27.1 </div><div class="doc-navbar-text">The status of extensions</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_3"><div class="doc-navbar-text">Built-in, installed and project-specific extensions</div><div class="nav-arrow">27.3→</div></a></div></div></div>
<p>When any source text is run through Inform, a secret first line is inserted, which reads:</p>
<div class="codeblock"><div class="codeline">Include the Standard Rules by Graham Nelson.</div>
</div><p>The &quot;Standard Rules&quot; file contains the definitions of the basic kinds, phrases, actions and grammar described in this documentation: for instance, it includes lines like</p>
<div class="codeblock"><div class="codeline">A container is a kind of thing.</div>
</div><p>&hellip;without which Inform would be lost. Although including the Standard Rules is compulsory, it is treated internally as if it were any other &quot;extension&quot;.</p>
<p>What happens when an &quot;Include&quot; sentence is reached is that the sentence is replaced with the whole text of the file in question, often many paragraphs long.</p>
<p>If the file has already been included, then the sentence is simply ignored. This is so that we can have two extensions, each of which needs the other: if A says to include B, and B says to include A, the result is that including one automatically includes the other, so we always get both which ever we ask for &ndash; not that there is a hideous infinite regress.</p>
<h3 id="section_3">WI §27.3 Built-in, installed and project-specific extensions</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_2" title="The Standard Rules"><div class="nav-arrow">←27.2 </div><div class="doc-navbar-text">The Standard Rules</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_4"><div class="doc-navbar-text">Authorship</div><div class="nav-arrow">27.4→</div></a></div></div></div>
<p>To recap: Inform builds projects from both the source text typed by the author and from Extensions; one of these, the Standard Rules, is always included; others are added as authors please. About 20 are &quot;built-in&quot; to Inform, meaning that they are stored inside the application and always available. Others must be &quot;installed&quot;, and each Inform user will have a folder somewhere on his computer which contains these. Users typically obtain these from the Public Library feature in the Inform application, but can also download them directly from the extension writer&#39;s website and then use an Install Extension menu option in the application. Either way, the application then squirrels the file away, and it becomes available to any projects that that user may be working on.</p>
<p>It is also possible to have extensions available to just one project. These must be stored in the Extensions subfolder of the project&#39;s &quot;.materials&quot; folder, but otherwise are arranged the same as installed extensions &ndash; there&#39;s an outer folder for each author&#39;s name, and extensions are named with a &quot;.i7x&quot; extension within. For example:</p>
<div class="codeblock"><div class="codeline">Mourning Hypercritical.inform</div>
<div class="codeline">Mourning Hypercritical.materials</div>
<div class="codeline">&ensp;&ensp;&ensp;Extensions</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;John Siracusa</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;Fixing The Finder.i7x</div>
</div><p>When Inform needs to find an extension, it looks here first, then in the installed area, then in its built-in area. That means that we can make our own revised or hacked version of an extension, put it in the &quot;.materials&quot; area, and then have it take precedence over the installed or built-in one. We could even have our own private version of the Standard Rules here.</p>
<p>(This has a number of possible uses &ndash; for example, to provide a convenient test-bed when working on an experimental version of an extension.)</p>
<h3 id="section_4">WI §27.4 Authorship</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_3" title="Built-in, installed and project-specific extensions"><div class="nav-arrow">←27.3 </div><div class="doc-navbar-text">Built-in, installed and project-specific extensions</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_5"><div class="doc-navbar-text">A simple example extension</div><div class="nav-arrow">27.5→</div></a></div></div></div>
<p>Extensions are identified by author and by name, so that a given author can produce his or her own range of extensions, and need only ensure that these are named differently from each other. If John Smith and Mary Brown each want to write an extension called &quot;Following People&quot;, there is no conflict.</p>
<p>The name of an extension, and of an author, should be written in Sentence Capitalisation: that is, upper case for the first letter in each word. (Inform uses this to minimise problems on machines where filenames are read with case sensitivity.) It is permitted for author names to include upper-case letters within words, as with the &quot;G&quot; in &quot;Jesse McGrew&quot;. In general it is best to avoid accented or unusual letters in titles and author names, but the standard ISO Latin-1 characters should be allowed &ndash; for instance,</p>
<div class="codeblock"><div class="codeline">Étude Pour La Fênetre by Françoise Gauß begins here.</div>
</div><p>The author name must not start with &quot;The&quot;, nor contain the words &quot;by&quot;, &quot;and&quot; or &quot;version&quot;, or contain punctuation, as in &quot;John X. Doe&quot;; the title similarly, except that &quot;and&quot; is permitted. Name and author&#39;s name must each be no more than 50 characters long, including any spaces between words.</p>
<p>Authors are asked to use real names rather than cryptic handles like &quot;ifguy&quot;, and to use genteel, plausible pseudonyms like &quot;Emily Short&quot; rather than, say, &quot;Drooling Zombie&quot; or &quot;Team Inform&quot;. Authors are also asked to use the same author&#39;s name for all their own extensions, and (it should go without saying) not to masquerade as anybody else.</p>
<p>Sometimes authorship is complicated. What if Mary Brown finds some Inform 6 code written by John Smith in the mid-90s, and puts an I7 gloss on it to make an I7 extension, but then Pierre Dupont translates it into French: who&#39;s the author of the result? The rule is that the person making the current, latest version is the author listed in the titling line, so we end up with</p>
<div class="codeblock"><div class="codeline">... by Pierre Dupont begins here.</div>
</div><p>But Mary and John deserve their credits too: see the next section for how to give them.</p>
<h3 id="section_5">WI §27.5 A simple example extension</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_4" title="Authorship"><div class="nav-arrow">←27.4 </div><div class="doc-navbar-text">Authorship</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_6"><div class="doc-navbar-text">Version numbering</div><div class="nav-arrow">27.6→</div></a></div></div></div>
<p>Extensions are plain text files, and can be created with any text editor. (It is sometimes said that &quot;there is no such thing as plain text&quot;, there being so many ways to represent exotic characters: so to be precise, an extension is a text file with the Unicode UTF-8 encoding, either with or without a BOM marker, using any of the possible forms of line-ending (Unix, Windows, Macintosh, or Unicode line divider). This is a detail which will only matter if the extension contains accented letters or other exotica.)</p>
<p>Extensions look very much like passages of Inform source, because except for a special introductory and concluding sentence, and one convention, that is all they are:</p>
<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`The Ducking Action by Beatrix Potter begins here.\n\n&quot;An action for ducking one&apos;s head.&quot;\n\nDucking is an action applying to nothing. Report ducking: say &quot;You duck!&quot; Understand &quot;duck&quot; as ducking.\n\nThe Ducking Action ends here.`)">⧉</button><div class="codeline">The Ducking Action by Beatrix Potter begins here.</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">&quot;An action for ducking one&#39;s head.&quot;</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">Ducking is an action applying to nothing. Report ducking: say &quot;You duck!&quot; Understand &quot;duck&quot; as ducking.</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">The Ducking Action ends here.</div>
</div><p>Not a useful or interesting extension, but those few words add a whole new action and everything needed to make it work. It is Inform&#39;s ability to mix up rooms, things, kinds, grammar, phrases and rules, in more or less any order, which makes it possible for extensions to work.</p>
<p>The introductory sentence must be placed as the only content of line 1 of the file, which must not contain comments, and has to be written in exactly the correct form. Inform checks this very carefully when performing its census of installed extensions, on each translation of the text. (In case the extension&#39;s title is a plural, we are allowed to write &quot;begin&quot; and &quot;end&quot; instead of &quot;begins&quot; and &quot;ends&quot;. For instance, the last line of the standard rules is &quot;The Standard Rules end here.&quot;)</p>
<p>The &quot;one convention&quot; mentioned above is that if a double-quoted text is placed immediately after the beginning sentence (and with no intervening comments), then it is taken to be a short description of the extension&#39;s content called the &quot;rubric&quot;. Hence the line:</p>
<div class="codeblock"><div class="codeline">&quot;An action for ducking one&#39;s head.&quot;</div>
</div><p>Providing a rubric is helpful, because it enables Inform to give a meaningful listing even for an as-yet unused and unindexed extension, and because it helps the Inform website to produce better directories. Note the word &quot;short&quot;: such text is likely to be truncated if it exceeds 500 characters.</p>
<p>A second double-quoted text can also, optionally, be added in yet a third special starting paragraph. This is to provide additional credits to people who have contributed to this or earlier versions. For instance:</p>
<div class="codeblock"><div class="codeline">The Ducking Action by Beatrix Potter begins here.</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">&quot;An action for ducking one&#39;s head.&quot;</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">&quot;based on original Inform 6 code by Marc Canard&quot;</div>
</div><p>Note the typical style here: it&#39;s a phrase rather than a sentence, and neither starts with an upper-case letter nor ends with a full stop. (The additional credit is then used in documentation and also in the VERSION text of any Inform story file using the extension.)</p>
<div class="examples">
<h4>Example</h4>
<div class="example-short"><div class="example-short-num"><span class="hidden"></span>448.</div><div class="example-short-name"><span class="example-short-name"><a href="examples/modern_conveniences.html">Modern Conveniences</a></span> <span class="stars">★★</span></div></div><div class="example-short"><div class="example-short-num"><span class="hidden">000.</span></div><div class="example-short-name">Exemplifying the kind of source we might use in writing extensions for kitchen and bathroom appliances.</div></div>
<div class="linkback"><a href="RB_8.html#section_5" title="Vehicles, Animals and Furniture &gt; Kitchen and Bathroom">RB §8.5 Kitchen and Bathroom</a></div>
</div>
<h3 id="section_6">WI §27.6 Version numbering</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_5" title="A simple example extension"><div class="nav-arrow">←27.5 </div><div class="doc-navbar-text">A simple example extension</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_7"><div class="doc-navbar-text">Extensions and story file formats</div><div class="nav-arrow">27.7→</div></a></div></div></div>
<p>As we have seen, extensions are referred to by name and author, but they can also (optionally) be referred to by version. For instance:</p>
<div class="codeblock"><div class="codeline">Include version 2 of the Ducking Action by Beatrix Potter.</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">Version 1.2.4 of the Ducking Action by Beatrix Potter begins here.</div>
</div><p>Version numbers should consist of one to three whole numbers divided by dots, with no negative numbers allowed. Thus &quot;5&quot;, &quot;3.3&quot; and &quot;2.1.71652&quot; are all valid as version numbers, but &quot;-4&quot; and &quot;3.1.2.5&quot; are not. Any numbers not specified are taken to be 0: thus &quot;3.3&quot; means the same as &quot;3.3.0&quot;, and &quot;5&quot; means the same as &quot;5.0.0&quot;.</p>
<p>In versions of Inform before 2022, versions of extensions were also allowed to be written in the form &quot;N/YYMMDD&quot;, as in this example:</p>
<div class="codeblock"><div class="codeline">Version 6/040426 of the Ducking Action by Beatrix Potter begins here.</div>
</div><p>The material after the slash &#39;/&#39; was expected to be a date, so that 040426 would mean 26 April 2004. In order to preserve compatibility with old extensions, Inform continues to allow this notation, but treats it as equivalent to writing &quot;N.0.YYMMDD&quot;, though with any leading 0s trimmed. So the above sentence is equivalent to writing:</p>
<div class="codeblock"><div class="codeline">Version 6.0.40426 of the Ducking Action by Beatrix Potter begins here.</div>
</div><p>Extensions are usually intended to be shared and passed around between Inform users, and good use of version numbering can be a huge help to those users; and it&#39;s helpful if we can agree as a community on what good version-numbering is. Because of that, the Inform project tries to use a widely-recognised Internet standard called &quot;semantic version numbering&quot;.</p>
<p>For full details see <a href="https://semver.org">semver.org</a>, but for Inform purposes the following fairly simple rules should be enough. &quot;Semantic&quot; just means that version number changes should communicate something meaningful. So, whenever an extension author puts out a new version of an extension, the extension number should change in a way that signals how drastic the change will be.</p>
<p>In this system, the three possible numbers X.Y.Z are called the &quot;major&quot;, &quot;minor&quot; and &quot;patch&quot; numbers. Every time an extension is changed and re-released, even just informally among friends but certainly if posted somewhere on the Internet, X, Y or Z should change. The rules are:</p>
<p>(X) If the extension has changed so much that Inform projects using it will need to be changed in order to keep on working &ndash; for example, if a &quot;To&hellip;&quot; phrase has been taken out, or the name of a kind changed &ndash; then X should be increased. Y and Z then usually go back to 0. This is a &quot;major version&quot;.</p>
<p>(Y) If the extension provides new features but doesn&#39;t do anything to change the way its existing features are used, then X can stay the same but Y should increase, and Z then usually rolls around to 0. This is a &quot;minor version&quot;.</p>
<p>(Z) If the extension has changed only to fix bugs, or make its existing features work more efficiently, or provide better documentation or examples, then X and Y can stay the same but Z should increase. This is a &quot;patch version&quot;.</p>
<p>So, for example, a user who currently has version 3.2.7 can update to 3.2.8 without really investigating. That same user can update to 3.3, 3.4, &hellip; without any trouble, choosing either to use or ignore whatever new features they are presenting. But the user knows that moving up to version 4 might well require some work &ndash; a project using version 3.Y.Z will likely need writing to adopt version 4.</p>
<p>Now let&#39;s turn to &quot;Include&quot; sentences. A request like:</p>
<div class="codeblock"><div class="codeline">Include the Ducking Action by Beatrix Potter.</div>
</div><p>will be happy with any version of the extension at all, whether numbered or not; but</p>
<div class="codeblock"><div class="codeline">Include version 2.4 of the Ducking Action by Beatrix Potter.</div>
</div><p>will only accept the extension if its version number is &quot;compatible&quot; with 2.4, which means, if it is 2.4 or later, but still belongs to the same major version, &quot;2&quot;. So if we write this inclusion sentence, but the version we have installed is version 3.1, Inform will give a problem message. The fix may well be as simple as changing the inclusion sentence to match &ndash; but it may not, because a change in major version number is a signal that things have changed a lot inside the extension (see above).</p>
<p>During play of any story compiled by Inform 7, typing VERSION lists various serial numbers of the pieces of software used to make it. The list concludes with names, authors and version numbers of any extensions used. So every author whose work contributes to a story automatically gets a modest credit within it. The same list can be printed, at the discretion of the designer, using the textual substitution:</p>
<div class="defn" id="phs_extcredits"><div class="defnline"><span class="defn">say "[the/-- list of extension credits]"</span></div><p>This text substitution expands to one or more lines of text crediting each of the extensions used by the current source text, along with their version numbers and authors. Extensions whose authors have chosen the &quot;use authorial modesty&quot; option are missed out.</p>
</div><p>If we want our extension to go uncredited &ndash; perhaps if it is a low-level enabling sort of thing, for instance &ndash; we can place the following sentence inside the definition of the extension:</p>
<div class="codeblock"><div class="codeline">Use authorial modesty.</div>
</div><p>The same sentence placed in the body of a source text causes all extensions by the same author as the main source text to go uncredited. In other words, if Isaac Miggins writes a source text and includes, say, Unlikely Events by Isaac Miggins, then this extension will go uncredited in the VERSION command.</p>
<p>A complete list, undiluted by modesty, can always be obtained using:</p>
<div class="defn" id="phs_compextcredits"><div class="defnline"><span class="defn">say "[the/-- complete list of extension credits]"</span></div><p>This text substitution expands to one or more lines of text crediting each of the extensions used by the current source text, along with their version numbers and authors. Every extension is included, even those whose authors have opted for &quot;use authorial modesty&quot;.</p>
</div><h3 id="section_7">WI §27.7 Extensions and story file formats</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_6" title="Version numbering"><div class="nav-arrow">←27.6 </div><div class="doc-navbar-text">Version numbering</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_8"><div class="doc-navbar-text">Extensions can include other extensions</div><div class="nav-arrow">27.8→</div></a></div></div></div>
<p>Inform compiles to several different story file formats, and in each case uses only a small part of their abilities &ndash; especially when it comes to fancy tricks with the keyboard or screen. So people may well want to write extensions which provide access to some of these tricks (like &quot;Basic Screen Effects&quot;, included in the standard Inform distribution, but more so). Unfortunately, these tricks are very likely to fail to compile &ndash; or fail to work &ndash; on some of the possible story file formats, so the resulting extension would probably go wrong (and mysteriously wrong) for users who have chosen a different format.</p>
<p>Inform therefore provides a way for extensions to declare the formats they are compatible with. All that is required is to add a proviso in brackets after the title is declared:</p>
<div class="codeblock"><div class="codeline">Version 2 of Basic Screen Effects (for Z-Machine version 8 only) by Emily Short begins here.</div>
</div><p>Other examples might be &quot;(for Glulx only)&quot;, or &quot;(for Z-machine only)&quot;. If no such proviso is given, the extension is assumed to be compatible with every story file format.</p>
<p>Extensions are also able to include material which is only used on some story file formats and not others &ndash; in principle, this might allow the same facilities to be provided to the author whatever story file format is used, but to achieve these effects differently depending on the current Settings. The convention here is exactly like &quot;not for release&quot;: if a heading or subheading in the source text contains a bracketed proviso, then the material under that heading (and under its dependent subheadings) will be ignored if the current story file format does not match. For example:</p>
<div class="codeblock"><div class="codeline i7header">Section 2.3G (for Glulx only)</div><div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">To reveal the explosion:</div>
<div class="codeline">&ensp;&ensp;&ensp;[...the Glulx way...]</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline i7header">Section 2.3Z (for Z-machine only)</div><div class="codeline">To reveal the explosion:</div>
<div class="codeline">&ensp;&ensp;&ensp;[...the Z-machine way...]</div>
</div><p>would ensure that &quot;reveal the explosion&quot; works nicely whichever story file format is used.</p>
<div class="examples">
<h4>Example</h4>
<div class="example-short"><div class="example-short-num"><span class="hidden"></span>449.</div><div class="example-short-name"><span class="example-short-name"><a href="examples/tilt3.html">Tilt 3</a></span> <span class="stars">★★</span></div></div><div class="example-short"><div class="example-short-num"><span class="hidden">000.</span></div><div class="example-short-name">Displaying the card suits from our deck of cards with red and black colored unicode symbols.</div></div>
<div class="linkback"><a href="RB_12.html#section_1" title="Typography, Layout, and Multimedia Effects &gt; Typography">RB §12.1 Typography</a></div>
</div>
<h3 id="section_8">WI §27.8 Extensions can include other extensions</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_7" title="Extensions and story file formats"><div class="nav-arrow">←27.7 </div><div class="doc-navbar-text">Extensions and story file formats</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_9"><div class="doc-navbar-text">Extensions can interact with other extensions</div><div class="nav-arrow">27.9→</div></a></div></div></div>
<p>Extensions can themselves contain &quot;Include&hellip;&quot; sentences asking for other extensions to be included. An extension might, for example, start like this:</p>
<div class="codeblock"><div class="codeline">Version 1 of Basic Help Menu by Emily Short begins here.</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">Include Menus by Emily Short.</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">...</div>
</div><p>A project which asks to include &quot;Basic Help Menu&quot; will then also include &quot;Menus&quot;, even though the author might never even realise that. Indeed, the author could also have asked to include &quot;Menus&quot;, not realising that &quot;Basic Help Menu&quot; was going to ask for the same thing.</p>
<p>So the same extension is often requested multiple times. This is fine if the version numbers in the requests are compatible, but they might not be. For instance, suppose the main source text asks to include version 2 of extension X, and also to include extension Y. Suppose further that Y contains a request to include version 4 of X. We now have two different requests for X, and they contradict each other &ndash; the major version of X cannot be both 2 and 4 at the same time. So Inform will produce a problem message in this case.</p>
<p>But in cases where it is possible for everyone to be satisfied, Inform will try to find a solution. If one extension asks for version 2.3 of X, and another asks just for X, and a third asks for version 2.7.2 of X, then Inform will work out that any version number in the range 2.7.2 up to (but not including) 3 will be fine. If it can in fact find such an extension, it will then use it. So if the user has version 2.8.17 installed, everything is fine.</p>
<p>If an extension does include other extensions, it is good style to place the &quot;Include&hellip;&quot; sentence(s) as early as possible after the introductory sentence, just so that human readers looking at the text of the extension can see these dependencies easily.</p>
<h3 id="section_9">WI §27.9 Extensions can interact with other extensions</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_8" title="Extensions can include other extensions"><div class="nav-arrow">←27.8 </div><div class="doc-navbar-text">Extensions can include other extensions</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_10"><div class="doc-navbar-text">Extensions in the Index</div><div class="nav-arrow">27.10→</div></a></div></div></div>
<p>When one extension is being used, it&#39;s probably only one among several. A really general-purpose extension might want to behave differently depending on which other extensions are also present. This can be achieved using headings which are &quot;for use with&quot; (or &quot;without&quot;) other extensions. For instance:</p>
<div class="codeblock"><div class="codeline i7header">Chapter 2a (for use with Locksmith by Emily Short)</div></div><p>specifies that everything under this heading (and its subheadings, if any) will be ignored unless the extension Locksmith by Emily Short is included. Conversely,</p>
<div class="codeblock"><div class="codeline i7header">Chapter 2b (for use without Locksmith by Emily Short)</div></div><p>will be ignored unless it isn&#39;t included. This allows an extension to give two variations on the same material &ndash; one if Locksmith is present, the other if not.</p>
<p>Headings can also replace portions of extensions which have been included. For instance:</p>
<div class="codeblock"><div class="codeline i7header">Section 6 - Hacked locking (in place of Section 1 - Regular locking in Locksmith by Emily Short)</div></div><p>places the source text under the new heading in the place of the old (which is thrown away). If there should be two or more headings of the same name in the given extension, the first is the one replaced; if two or more headings attempt to replace the same heading in the given extension, the final attempt in source text order is the one which succeeds; and finally, heading dependencies like the above are scanned in a top-down way. Thus, if we have:</p>
<div class="codeblock"><div class="codeline i7header">Chapter 2a (for use with Locksmith by Emily Short)</div><div class="codeline">...</div>
<div class="codeline i7header">Section 1 - Hacked marbles (in place of Section 4 in Marbles by Peter Wong)</div><div class="codeline">...</div>
</div><p>and we don&#39;t include Locksmith, then the replacement of Section 4 of Marbles is not made, because Section 1 &ndash; Hacked marbles is subordinate to the Chapter 2a heading which we&#39;ve told Inform to ignore.</p>
<p>If the name of the heading to replace contains the word &quot;in&quot;, it&#39;s a good idea to use quotation marks for clarity:</p>
<div class="codeblock"><div class="codeline i7header">Section - Hacked questions (in place of &quot;Section 4 - Phrase used to ask questions in closed mode&quot; in Questions by Michael Callaghan)</div></div><h3 id="section_10">WI §27.10 Extensions in the Index</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_9" title="Extensions can interact with other extensions"><div class="nav-arrow">←27.9 </div><div class="doc-navbar-text">Extensions can interact with other extensions</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_11"><div class="doc-navbar-text">Extension documentation</div><div class="nav-arrow">27.11→</div></a></div></div></div>
<p>As soon as a project has successfully been translated, its Index is brought up to date: pages of the index record all the kinds and what they are for, all the phrases which can be used, and so on. Any kind or phrase created in an extension is automatically included. The extension&#39;s presence in the project is itself recorded &ndash; the Contents index for any project contains a brief list of all extensions used in that project, along with their authors and version numbers.</p>
<p>The Kinds index aims to give the reader a brief note of what each kind is intended for. We can provide for this by writing a sentence like so:</p>
<div class="codeblock"><div class="codeline">The specification of player&#39;s holdall is &quot;Represents a container which the player can carry around as a sort of rucksack, into which spare items are automatically stowed away.&quot;</div>
</div><p>There is no need to specify the properties which apply: that is all done automatically. &quot;Specification&quot; is a sort of pseudo-property used just for this: we can also give specifications to kinds of value and to actions, and these are similarly used in the Index pages.</p>
<p>Every extension has the right to its own set of headings and subheadings, independently of those used by the main source for the work or by any other extension which may be included. (So if the extension is divided into four sections and finishes on Section D, say, that doesn&#39;t mean that Section D will continue outside the extension as the main source of the story runs on.)</p>
<p>Extensions should, of course, be written so that they never produce Problem messages, so at first sight it appears that these headings will never be outwardly visible. In fact, though, Problems do occasionally turn up in extensions, usually when the user has made a mistake, or when two inconsistent extensions are used in the same project. But more importantly, the headings in an extension are used when indexing phrases (and also actions) to group similar phrases together. For instance, the Standard Rules contain the heading:</p>
<div class="codeblock"><div class="codeline i7header">Section SR4/7 - Searching and sorting tables</div></div><p>The half-dozen phrases defined in this section of the Standard Rules are then indexed under the subheading &quot;Searching and sorting tables&quot;: Inform looks for a hyphen in the heading and then uses any text which follows the hyphen. (If there is no hyphen, the entire heading text is used.)</p>
<p>If an extension contains no headings, its phrases (or actions) are indexed simply as &quot;Miscellaneous&quot;.</p>
<p>Finally, any phrase or variable defined immediately under a heading whose name ends in the word &quot;unindexed&quot; will be omitted from the Phrasebook or Contents index respectively. (That won&#39;t apply to definitions under subheadings of the heading.) This is intended so that technical apparatus used only inside the extensions can be concealed from the outside user&#39;s immediate view. Inform as it is presently constituted does not allow extensions to make fully private definitions, but this feature at least allows them to make unadvertised ones.</p>
<h3 id="section_11">WI §27.11 Extension documentation</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_10" title="Extensions in the Index"><div class="nav-arrow">←27.10 </div><div class="doc-navbar-text">Extensions in the Index</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_12"><div class="doc-navbar-text">Examples and headings in extension documentation</div><div class="nav-arrow">27.12→</div></a></div></div></div>
<p>A basic mechanism for documenting extensions is built into Inform. For many extensions, this will probably do instead of a manual; for more complex ones, it should still prove a useful supplement to one.</p>
<p>As described in Chapter 2 above, whenever an extension is installed, its documentation is made available to the user. Such text should be written concisely, while giving examples wherever appropriate. Stylistically, it should ideally follow the model of the main Inform documentation: just as an extension expands the standard rules, so its documentation expands this manual. &quot;We need&hellip;&quot; is preferred to &quot;You need&hellip;&quot;, and so on: we&#39;re all in this together.</p>
<p>In order to be recognised as documentation, this text should appear at the foot of the extension file, <em>after</em> the compulsory end sentence. The first paragraph must have exactly the following form, with a skipped line before and after:</p>
<div class="codeblock"><div class="codeline">---- DOCUMENTATION ----</div>
</div><p>For instance, the &quot;Ducking Action&quot; example might end:</p>
<div class="codeblock"><div class="codeline">...</div>
<div class="codeline">The Ducking Action ends here.</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">---- DOCUMENTATION ----</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">This is a modest extension, with much to be modest about. It allows us to use a new action for ducking, as in ducking the player&#39;s head (not as in ducking a witch). Ducking will do nothing unless rules are added:</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">&ensp;&ensp;&ensp;Instead of ducking in the Shooting Gallery, say &quot;Too late!&quot;</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">...</div>
</div><p>We obtain indented code examples by beginning a line with a tab. A double indentation can be got with two tabs in a row, and so forth. (Beware: some text editors, or emailers, flatten tabs into a row of four or perhaps eight spaces each. Inform will not recognise such a line of spaces as a tab.)</p>
<p>Note that text in square brackets should be avoided in the documentation, because that&#39;s taken as being comment matter on the extension, and omitted.</p>
<p>Tables should be similarly indented, and should begin with the word &quot;Table &hellip;&quot;: the top line is taken to be the name of the table, and subsequent lines are tab-divided columns. Inform will automatically group this into a table, like so:</p>
<div class="codeblock"><div class="codeline tablename">Table of Exemplariness</div><table>
<tr><td>stellar object</td><td>example</td></tr><tr><td>galaxy</td><td>&quot;Andromeda Galaxy M31&quot;</td></tr><tr><td>star</td><td>&quot;Sirius&quot;</td></tr><tr><td>planet</td><td>&quot;Neptune&quot;</td></tr><tr><td>moon</td><td>&quot;Enceladus&quot;</td></tr><tr><td>dwarf planet</td><td>&quot;Ceres&quot;</td></tr><tr><td>plutino</td><td>&quot;38628 Huya&quot;</td></tr><tr><td>cubewano</td><td>&quot;Easterbunny&quot;</td></tr></table>
</div><p>(Footnote: Since the first appearance of this book, Easterbunny has been renamed Makemake, the creator god in the mythology of the people of Easter Island.)</p>
<h3 id="section_12">WI §27.12 Examples and headings in extension documentation</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_11" title="Extension documentation"><div class="nav-arrow">←27.11 </div><div class="doc-navbar-text">Extension documentation</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_13"><div class="doc-navbar-text">Implications</div><div class="nav-arrow">27.13→</div></a></div></div></div>
<p>Extensions with very large amounts of documentation can, if the author chooses, divide the material up using headings and/or subheadings. These must be written as paragraphs exactly like so:</p>
<div class="codeblock"><div class="codeline i7header">Chapter: Avoiding Events</div><div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline i7header">Section: Ducking examinations and tests</div></div><p>Inform will then typeset them to stand out, will number them automatically, and will add a table of contents at the top of the page. (For most extensions, the documentation will be short and sweet, and this would just be clutter: headings and subheadings are best used only where the text would otherwise be difficult to read.)</p>
<p>Any extension&#39;s documentation can contain Examples, just as the main Inform documentation does: these are automatically labelled A, B, C, &hellip; rather than given numbers, to ensure that they do not clash with the numbering used in the built-in chapters. (The labels may be helpful in writing an extension&#39;s documentation: we can write, for instance, a note such as &quot;see Example C below&quot;.)</p>
<p>Examples must be given last in the documentation, and there can be up to 26 of them, though most extensions will need one example at the most, and some will have none at all. Each example must begin with a paragraph exactly like so:</p>
<div class="codeblock"><div class="codeline">Example: ** We Must Perform a Quirkafleeg - Ducking to avoid arrows as one proceeds east across battlements.</div>
</div><p>Again, there must be a skipped line before and after. The row of asterisks must be *, **, *** or ****, just as in the main documentation, which we should follow on all points of style. The rest of the line contains the title, a hyphen, and then the description. The title should be given with Each Word except Prepositions and Similar Things Capitalized, while the description should look like a sentence, and end with a full stop.</p>
<p>The text of the example follows, of course, and continues until the end of the file, or the next &quot;Example:&quot; line, whichever comes first.</p>
<p>Each example should (normally) contain one single, complete, story, long enough to demonstrate the use of the extension and to have a little flavour to it, but not so long that the reader gets lost. It should have a title, which should match the name of the example (in the case above, &quot;We Must Perform a Quirkafleeg&quot;). It should conclude with a paragraph defining a test:</p>
<div class="codeblock"><div class="codeline">Test me with &quot;east / duck / east / jump / east / duck / east / rescue esmerelda&quot;.</div>
</div><p>The idea is that typing one single command, TEST ME, into the resulting story should show off what the extension does.</p>
<p>When an extension contains more than one example, they should be given in order of asterisk rating, that is, starting with the * examples, then the ** examples, and so on up.</p>
<p>Extension documentation can provide &quot;paste&quot; buttons, much like the examples in this book. For example:</p>
<div class="codeblock"><div class="codeline">Here is a sample -</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">&ensp;&ensp;&ensp;*: &quot;Coriander&quot;</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">&ensp;&ensp;&ensp;Include Herbs by Charlotte Quirke.</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">&ensp;&ensp;&ensp;The Herb Marketing Centre is a room.</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">If we want to add some content -</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">&ensp;&ensp;&ensp;The coriander is a herb. Understand &quot;cilantro&quot; as the coriander.</div>
</div><p>Note that the paste button, denoted &quot;*:&quot;, pastes in the text following it, but only as far as the next paragraph of unindented documentation &ndash; here, the one beginning &quot;If we&hellip;&quot;. (But of course, an extension can have multiple paste buttons if desired.)</p>
<h3 id="section_13">WI §27.13 Implications</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_12" title="Examples and headings in extension documentation"><div class="nav-arrow">←27.12 </div><div class="doc-navbar-text">Examples and headings in extension documentation</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_14"><div class="doc-navbar-text">Using Inform 6 within Inform 7</div><div class="nav-arrow">27.14→</div></a></div></div></div>
<p>Extensions often need to define new kinds or properties, which we want to make as helpful as possible for the user. In particular, we want them not to require additional work for the author just to obtain the effect which seems only natural.</p>
<p>For example, consider Inform&#39;s built-in &quot;locked&quot; property. If a door is locked, then it cannot be opened, which seems fair enough. But if the player tries to unlock the door, he might then find the following response:</p>
<div class="codeblock"><div class="codeline">That doesn&#39;t seem to be something you can unlock.</div>
</div><p>Which does not seem right. In real life, almost all locked items have outwardly exposed locks which it is perfectly sensible to try to unlock, given a key. The problem is that our door has the &quot;locked&quot; property, but not the &quot;lockable&quot; one.</p>
<p>The Standard Rules solve this problem by including the following line:</p>
<div class="codeblock"><div class="codeline">Something locked is usually lockable.</div>
</div><p>This ensures that any door said by the author only to be &quot;locked&quot; will be &quot;lockable&quot; as well, and adds a small but worthwhile touch of realism.</p>
<p>Such a sentence is called an &quot;implication&quot;, as it is in the form &quot;Condition A implies Condition B&quot;. Note that the two conditions must consist of either/or properties with or without kinds attached. Thus:</p>
<div class="codeblock"><div class="codeline">A room in the Open Desert is usually lighted.</div>
</div><p>will not work because &quot;a room in the Open Desert&quot; is a more complicated grammatical construction than, say, &quot;lighted&quot; or &quot;a lighted room&quot;: it contains a relative clause. Inform can only deal with simple implications.</p>
<p>Inform never overrides certainties with mere implications, and is cautious about allowing them to build overly long chains of argument. This is to prevent the following kind of difficulty:</p>
<div class="codeblock"><div class="codeline">An open door is usually closed. A closed door is usually open.</div>
</div><p>Implications work just the same for values which aren&#39;t objects, so:</p>
<div class="codeblock"><div class="codeline">Colour is a kind of value. The colours are red, green and blue.</div>
<div class="codeline">A colour can be zesty or flat. A colour can be bright or dull.</div>
<div class="codeline">Red and blue are bright. Blue is flat.</div>
<div class="codeline">&ensp;&ensp;&ensp;</div>
<div class="codeline">A bright colour is usually zesty.</div>
</div><p>results in red being zesty, but blue and green being flat; blue because the source text explicitly says so (which trumps the &quot;usually&quot;), and green because this isn&#39;t a bright colour, so the implication doesn&#39;t arise.</p>
<p>Implications have not been mentioned up to now since they are only really needed by extensions, but also because they can be tricky, with unforeseen consequences. We should handle them with care.</p>
<h3 id="section_14">WI §27.14 Using Inform 6 within Inform 7</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_13" title="Implications"><div class="nav-arrow">←27.13 </div><div class="doc-navbar-text">Implications</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_15"><div class="doc-navbar-text">Defining phrases in Inform 6</div><div class="nav-arrow">27.15→</div></a></div></div></div>
<p>The current Inform, &quot;Inform 7&quot;, had a low-level precursor unsurprisingly called Inform, which ran through versions 1 to 6. What made Inform 6 low-level was that its style of coding was much more like traditional programming: it reads as a simple form of C, or an elaborate form of assembly-language, but with some interactive fiction tweaks.</p>
<p>That language is still used inside today&#39;s Inform project as a way to express very low-level operations. What happens to code like that is now very different (it is compiled into Inter, an intermediate-level representation used inside Inform, and no longer by the Inform 6 compiler). But the notation is the same, and the practical effect is that it is as if we are writing I6 code.</p>
<p>The final sections of this chapter show how such I6 code can be mixed directly in with natural-language source text. The remaining pages will therefore make little or no sense to those who do not already know I6 notation, and in any case, such programming is really a last resort &ndash; it is always best to write regular source text than to resort to so-called &quot;inclusions&quot; of I6. Ideally, all I6 content would be confined to extensions (and this may be mandated in future releases of Inform), and even writers of extensions are asked to pare down their usage of I6 to the minimum necessary.</p>
<p>The methods for incorporating I6 code into I7 have been designed with this in mind, that is, to encourage people to use I6 in as self-contained a way as possible: in particular to isolate the relatively few functions which need to be written in I6, and to give them natural language expression.</p>
<p>Finally, anyone hacking with I7 for a while is likely to become curious about the Basic Inform or Standard Rules extensions, and to look at the text which sets up the Inform language and world model. These extensions are, of course, no secret, but can be misleading to read. For one thing, they appear to have great freedom to set up the world model as it pleases, but in fact the I7 compiler may well crash unless certain things are done just so in the Standard Rules: they depend on each other.</p>
<p>Moreover, the Basic Inform and Standard Rules extensions use a number of syntaxes which are not documented in this chapter: these are constantly being altered, and it would not be safe to imitate them. Any I6-related syntax which is not documented in this chapter may be removed or changed in effect at any time without warning, for instance in an update of Inform to fix bugs.</p>
<h3 id="section_15">WI §27.15 Defining phrases in Inform 6</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_14" title="Using Inform 6 within Inform 7"><div class="nav-arrow">←27.14 </div><div class="doc-navbar-text">Using Inform 6 within Inform 7</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_16"><div class="doc-navbar-text">Phrases to decide in Inform 6</div><div class="nav-arrow">27.16→</div></a></div></div></div>
<p>The phrases described in this documentation, such as &quot;end the story&quot;, are all defined in the Standard Rules, and are for the most part defined not in terms of other I7 phrases but instead reduced to equivalents in I6. For instance:</p>
<div class="codeblock"><div class="codeline">To end the story: (- deadflag=3; story_complete=false; -).</div>
</div><p>The notation &quot;(-&quot; and &quot;-)&quot; indicates that what comes in between is I6 code. The minus sign is supposed to be a mnemonic for the decrease from 7 to 6: later we shall use &quot;(+&quot; and &quot;+)&quot; to go back up the other way, from 6 to 7.</p>
<p>When a phrase is defined as containing only a single command, and that command is defined using I6 &ndash; as here &ndash; it is compiled in-line. This means that the phrase &quot;end the story&quot; will always be translated as &quot;deadflag=3; story_complete=false;&quot;, rather than being translated into a call to a suitable function whose only statement is &quot;deadflag=3; story_complete=false;&quot;.</p>
<p>This is an easy case since the wording never varies. More typical examples would be:</p>
<div class="codeblock"><div class="codeline">To say (something - number): (- print {something}; -).</div>
<div class="codeline">To sort (T - table name) in (TC - table column) order:</div>
<div class="codeline">&ensp;&ensp;&ensp;(- TableSort({T}, {TC}, 1); -).</div>
</div><p>When the braced name of one of the variables in the phrase preamble appears, this is compiled to the corresponding I6 expression at the relevant position in the I6 code. So, for instance,</p>
<div class="codeblock"><div class="codeline">say the capacity of the basket</div>
</div><p>might be compiled to</p>
<div class="codeblock"><div class="codeline">print O17_basket.capacity;</div>
</div><p>because &quot;{something}&quot; is expanded to &quot;capacity of the basket&quot; (I7 code) and then translated to &quot;O17_basket.capacity&quot; (I6 code), which is then spliced into the original I6 definition &quot;print {something};&quot;.</p>
<p>Braces &quot;{&quot; are of course significant in I6. A real brace can be obtained by making the character following it a space, and then I7 will not attempt to read it as a request for substitution.</p>
<p>It&#39;s also possible for the pair of characters &quot;-)&quot; to occur in I6 code, for example here:</p>
<div class="codeblock"><div class="codeline">for (i=3 : i&gt;0 : i--)</div>
</div><p>and I7 will read the &quot;-)&quot; as terminating the I6; we can get around this with an extra space:</p>
<div class="codeblock"><div class="codeline">for (i=3 : i&gt;0 : i-- )</div>
</div><p>Warning: Inform 6 uses a restricted character set, allowing use of most of the accented characters in ISO Latin-1 (those found in a set called ZSCII) but little beyond that. It&#39;s therefore hazardous to use any exotic Unicode characters in an inclusion.</p>
<div class="examples">
<h4>Example</h4>
<div class="example-short"><div class="example-short-num"><span class="hidden"></span>450.</div><div class="example-short-name"><span class="example-short-name"><a href="examples/pink_or_blue.html">Pink or Blue</a></span> <span class="stars">★★★</span></div></div><div class="example-short"><div class="example-short-num"><span class="hidden">000.</span></div><div class="example-short-name">Asking the player to select a gender to begin play.</div></div>
<div class="linkback"><a href="RB_5.html#section_2" title="The Viewpoint Character &gt; Traits Determined By the Player">RB §5.2 Traits Determined By the Player</a></div>
</div>
<h3 id="section_16">WI §27.16 Phrases to decide in Inform 6</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_15" title="Defining phrases in Inform 6"><div class="nav-arrow">←27.15 </div><div class="doc-navbar-text">Defining phrases in Inform 6</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_17"><div class="doc-navbar-text">Handling phrase options</div><div class="nav-arrow">27.17→</div></a></div></div></div>
<p>There are basically three forms of phrase in I7: phrases which do something, but produce no value or opinion as a result; phrases to decide whether or not something is true; and phrases to decide on a value. We have already seen examples of writing the first form in I6:</p>
<div class="codeblock"><div class="codeline">To say (something - number): (- print {something}; -).</div>
</div><p>Here the I6 form is required to be I6 routine code in void context, that is, it will normally be one or more statements each of which ends in a semicolon (unless there are braced code blocks present). In this case, we have just one I6 statement, ending in a semicolon.</p>
<p>An example of a phrase to decide whether something is true would be:</p>
<div class="codeblock"><div class="codeline">To decide whether in darkness: (- (location==thedark) -).</div>
</div><p>Here the I6 code providing the definition must be a valid I6 condition, and be in round brackets, but there is no semicolon.</p>
<p>Lastly, an example of a phrase to decide on a value:</p>
<div class="codeblock"><div class="codeline">To decide which number is the hours part of (t - time): (- ({t}/60) -).</div>
</div><p>Again, this is a value in I6 as well: no semicolon. It is probably safest to place the value in round brackets.</p>
<h3 id="section_17">WI §27.17 Handling phrase options</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_16" title="Phrases to decide in Inform 6"><div class="nav-arrow">←27.16 </div><div class="doc-navbar-text">Phrases to decide in Inform 6</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_18"><div class="doc-navbar-text">Making and testing use options</div><div class="nav-arrow">27.18→</div></a></div></div></div>
<p>The Standard Rules use the Inform list-writer with the following definition, which shows how a much more complicated I6 routine can be given a natural-language expression.</p>
<div class="codeblock"><button class="copycode" title="Copy to clipboard" onclick="copyCode(`To list the contents of (O - an object),\n\twith newlines,\n\tindented,\n\tgiving inventory information,\n\tas a sentence,\n\tincluding contents,\n\tincluding all contents,\n\ttersely,\n\tgiving brief inventory information,\n\tusing the definite article,\n\tlisting marked items only,\n\tprefacing with is/are,\n\tnot listing concealed items,\n\tsuppressing all articles\n\tand/or with extra indentation:\n\t(- I7WriteListFrom(child({O}), {phrase options}); -).`)">⧉</button><div class="codeline">To list the contents of (O - an object),</div>
<div class="codeline">&ensp;&ensp;&ensp;with newlines,</div>
<div class="codeline">&ensp;&ensp;&ensp;indented,</div>
<div class="codeline">&ensp;&ensp;&ensp;giving inventory information,</div>
<div class="codeline">&ensp;&ensp;&ensp;as a sentence,</div>
<div class="codeline">&ensp;&ensp;&ensp;including contents,</div>
<div class="codeline">&ensp;&ensp;&ensp;including all contents,</div>
<div class="codeline">&ensp;&ensp;&ensp;tersely,</div>
<div class="codeline">&ensp;&ensp;&ensp;giving brief inventory information,</div>
<div class="codeline">&ensp;&ensp;&ensp;using the definite article,</div>
<div class="codeline">&ensp;&ensp;&ensp;listing marked items only,</div>
<div class="codeline">&ensp;&ensp;&ensp;prefacing with is/are,</div>
<div class="codeline">&ensp;&ensp;&ensp;not listing concealed items,</div>
<div class="codeline">&ensp;&ensp;&ensp;suppressing all articles</div>
<div class="codeline">&ensp;&ensp;&ensp;and/or with extra indentation:</div>
<div class="codeline">&ensp;&ensp;&ensp;(- I7WriteListFrom(child({O}), {phrase options}); -).</div>
</div><p>This can be used by, say:</p>
<div class="codeblock"><div class="codeline">list the contents of O, as a sentence, using the definite article</div>
</div><p>&quot;{phrase options}&quot; is a special substitution: it is a bitmap which assigns the given options one bit each, starting with the least significant bit for the first-mentioned option (&quot;with newlines&quot; above) and going up to the most significant bit for the last (&quot;with extra indentation&quot;).</p>
<h3 id="section_18">WI §27.18 Making and testing use options</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_17" title="Handling phrase options"><div class="nav-arrow">←27.17 </div><div class="doc-navbar-text">Handling phrase options</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_19"><div class="doc-navbar-text">Longer extracts of Inform 6 code</div><div class="nav-arrow">27.19→</div></a></div></div></div>
<p>Use options (see Chapter 2 above) manifest themselves in the I6 code generated by I7 as constants which are either defined, or not. For instance, the &quot;use American dialect&quot; option results in the constant DIALECT_US being defined, a constant which otherwise would not be. Some use options define the constant as a particular value, others simply define it (so that I6 gives this constant the value 0).</p>
<p>New use options can be created as in the following examples, which are found in the Standard Rules:</p>
<div class="codeblock"><div class="codeline">Use American dialect translates as (- Constant DIALECT_US; -).</div>
<div class="codeline">Use full-length room descriptions translates as (- Constant I7_LOOKMODE = 2; -).</div>
</div><p>Most Inform users will not need to test whether a use option is currently set: after all, they will know whether or not their own story uses American dialect. But an extension does not know what use options apply in the story which is using it. An extension which needs to print a list, using its own formatting, might want to know whether &quot;use serial comma&quot; is set. Or it might want to speak differently in American dialect.</p>
<p>To test for American dialect, we should ideally not use I6 to look for the constant DIALECT_US using #ifdef: there is no guarantee that this constant will not be renamed at some point. Instead we can perform the test directly in I7:</p>
<div class="codeblock"><div class="codeline">if the American dialect option is active, ...</div>
</div><p>and similarly for all other named use options. The adjectives &quot;active&quot; and &quot;inactive&quot; have the obvious meanings for use options. This means it&#39;s possible to describe the current options like so:</p>
<div class="codeblock"><div class="codeline">say &quot;We&#39;re currently using: [list of active use options].&quot;;</div>
</div><p>The result might be, say,</p>
<div class="codeblock"><div class="codeline">We&#39;re currently using: dynamic memory allocation option [8192], maximum text length option [1024], maximum things understood at once option [100], American dialect option and fast route-finding option.</div>
</div><p>This may be useful for testing purposes.</p>
<p>Use options can also allow the writer to raise certain maximum values. If we write an extension which needs some I6 array, say, and therefore has some limitation &ndash; for instance a footnotes presenter which can handle at most 100 footnotes before its array space runs out &ndash; it would obviously be cleaner to allow this maximum to be raised. We can set this up like so:</p>
<div class="codeblock"><div class="codeline">Use maximum presented footnotes of at least 100 translates as (- Constant MAX_PRESENTED_FOOTNOTES = {N}; -).</div>
</div><p>With such a definition, the number given is the default value, and the I6 source is included whether or not anybody uses the option: the default value being given if nobody does. The text &quot;{N}&quot; is replaced with the value. So the above definition normally results in this being defined:</p>
<div class="codeblock"><div class="codeline">Constant MAX_PRESENTED_FOOTNOTES = 100;</div>
</div><p>but if the user writes</p>
<div class="codeblock"><div class="codeline">Use maximum presented footnotes of at least 350.</div>
</div><p>then instead the I6 inclusion becomes:</p>
<div class="codeblock"><div class="codeline">Constant MAX_PRESENTED_FOOTNOTES = 350;</div>
</div><p>The I6 constant MAX_PRESENTED_FOOTNOTES can then be used as the size of an array, for instance.</p>
<p>Finally, note that it is legal to define the same use option more than once, but only if it has exactly the same meaning each time it is defined. (This is allowed so that multiple extensions all needing the same definition can safely make it, and still be used together.)</p>
<h3 id="section_19">WI §27.19 Longer extracts of Inform 6 code</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_18" title="Making and testing use options"><div class="nav-arrow">←27.18 </div><div class="doc-navbar-text">Making and testing use options</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_20"><div class="doc-navbar-text">Primitive Inform 6 declarations of rules</div><div class="nav-arrow">27.20→</div></a></div></div></div>
<p>Whole routines, object and class definitions (or any other directives) can be pasted in wholesale using sentences like so:</p>
<div class="codeblock"><div class="codeline">Include (-</div>
<div class="codeline">[ ExtraFunction a b; return a*b; ];</div>
<div class="codeline">-).</div>
</div><p>Such inclusions are pasted into the final compiled code at the end of the file, after the I6 grammar has been declared.</p>
<p>In such extracts, we sometimes need to refer to objects, variables or values which can&#39;t be described using I6: or rather, which can be described, but we don&#39;t know how. To this end, any text in an inclusion written in &quot;(+&quot; and &quot;+)&quot; parentheses is treated as an I7 value, and compiled accordingly, with all type-checking waived for the occasion. For instance:</p>
<div class="codeblock"><div class="codeline">Include (-</div>
<div class="codeline">Global my_global = (+ the tartan rucksack +);</div>
<div class="codeline">-).</div>
</div><p>Here &quot;the tartan rucksack&quot; is translated into &quot;O18_tartan_rucksack&quot;, or something similar: the I6 object created to represent the rucksack. Thus the actual line of code produced is</p>
<div class="codeblock"><div class="codeline">Global my_global = O18_tartan_rucksack;</div>
</div><p>The material between &quot;(+&quot; and &quot;+)&quot; is generally treated as a value, and thus compiles to the I6 form of that value. But it could also be a property name, which compiles to the I6 form in question, or a defined adjective, which compiles to the name of the routine to call which tests whether that adjective is true.</p>
<p><strong>Three warnings.</strong> The material in &quot;(-&quot; and &quot;-)&quot; is not quite treated as literal. Certain characters cause Inform to react:</p>
<p>1. Beware of accidental &quot;(+&quot; usage &ndash; for instance,</p>
<div class="codeblock"><div class="codeline">Include (-</div>
<div class="codeline">[ MyCleverLoop i; for (++i; i&lt;10; i++) print i; ];</div>
<div class="codeline">-).</div>
</div><p>looks reasonable, but contains &quot;(+&quot; and &quot;+)&quot;. Spaces around the first &quot;++&quot; would have been enough to avoid this one; &quot;+)&quot; is only significant where it follows a &quot;(+&quot;.</p>
<p>2. Beware of placing an &quot;@&quot; character in the first column, that is, immediately following a new line. (In template code this marks off paragraph divisions.) So for instance,</p>
<div class="codeblock"><div class="codeline">Include (-</div>
<div class="codeline">[ Set_Stream ret;</div>
<div class="codeline">@glk 67 ret;</div>
<div class="codeline">];</div>
<div class="codeline">-).</div>
</div><p>is tripped up by the Glulx assembly language opcode &quot;@glk&quot; because this occurs in column 1. Indenting it with a little space or a tab is enough to avoid the problem.</p>
<p>3. Be careful if you&#39;re creating an I6 variable holding initialised I7 text. For example,</p>
<div class="codeblock"><div class="codeline">Include (-</div>
<div class="codeline">Global saved_optional_prompt = (+ &quot;!!&gt;&quot; +);</div>
<div class="codeline">-).</div>
</div><p>looks as if it will work, but doesn&#39;t, for reference-counting reasons we needn&#39;t go into; instead you need</p>
<div class="codeblock"><div class="codeline">Include (-</div>
<div class="codeline">Array sop_storage --&gt; PACKED_TEXT_STORAGE &quot;!!&gt;&quot;;</div>
<div class="codeline">Global saved_optional_prompt = sop_storage;</div>
<div class="codeline">-).</div>
</div><p>But it&#39;s far better to avoid initialising text variables from I6 entirely. The same problems arise with constant lists.</p>
<p>It should also be noted that the I6 syntax recognised inside &quot;Include (- &hellip; -)&quot; is slightly restricted compared to the full range recognised by the stand-alone Inform 6 compiler. In particular:</p>
<p>1. Only new-style &quot;for&quot; loops with colons in the header are allowed, so that &quot;for (i=0: i&lt;10: i++)&quot; is okay but &quot;for (i=0; i&lt;10; i++)&quot; is not. Moreover, &quot;for&quot; loops cannot contain empty clauses.</p>
<p>2. Local variable names are not allowed to be the same as an I6 statement keyword: for example, &quot;style&quot; and &quot;spaces&quot; are not allowed.</p>
<p>3. The (undocumented) Inform 6 function &quot;indirect()&quot; is not supported. But since &quot;indirect(A)&quot; is equivalent to &quot;A()&quot;, which does work, this is no real loss. Similarly, the &quot;glk()&quot; function is not supported: function calls to BasicInformKit should be used instead.</p>
<p>4. Conditional compilation cannot be placed around cases in a &quot;switch&quot; statement.</p>
<p>5. Compile-time constant expression evaluation can be used with arithmetic operations, so &quot;Constant FOO = BAR + 1;&quot; is okay, but not with bitwise or logical operations, so &quot;Constant FOO = (BAR | 1);&quot; does not work.</p>
<p>6. Calculated values cannot occur as assembly-language operands.</p>
<p>7. Calculated values can be used for array extents, but need to be put in brackets. For example:</p>
<div class="codeblock"><div class="codeline">Include (-</div>
<div class="codeline">Array unit_captured_text --&gt; (UNIT_CAPTURE_BUFFER_LEN + 1);</div>
<div class="codeline">-).</div>
</div><div class="examples">
<h4>Example</h4>
<div class="example-short"><div class="example-short-num"><span class="hidden"></span>451.</div><div class="example-short-name"><span class="example-short-name"><a href="examples/status_line_with_centered_text_the_hard_way.html">Status line with centered text, the hard way</a></span> <span class="stars">★</span></div></div><div class="example-short"><div class="example-short-num"><span class="hidden">000.</span></div><div class="example-short-name">A status line which has only the name of the location, centered.</div></div>
<div class="linkback"><a href="RB_12.html#section_2" title="Typography, Layout, and Multimedia Effects &gt; The Status Line">RB §12.2 The Status Line</a></div>
</div>
<h3 id="section_20">WI §27.20 Primitive Inform 6 declarations of rules</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_19" title="Longer extracts of Inform 6 code"><div class="nav-arrow">←27.19 </div><div class="doc-navbar-text">Longer extracts of Inform 6 code</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_21"><div class="doc-navbar-text">Inform 6 objects and classes</div><div class="nav-arrow">27.21→</div></a></div></div></div>
<p>By writing a sentence like this:</p>
<div class="codeblock"><div class="codeline">The underground rule translates into I6 as &quot;UNDERGROUND_R&quot;.</div>
</div><p>we create a new rule, the &quot;underground rule&quot;, and also notify Inform that it will have no definition as I7 source text: instead, it will be provided as an I6 routine called &quot;UNDERGROUND_R&quot;. We can define this with an Include like so:</p>
<div class="codeblock"><div class="codeline">Include (-</div>
<div class="codeline">[ UNDERGROUND_R;</div>
<div class="codeline">&ensp;&ensp;&ensp;if (real_location hasnt light) { RulebookSucceeds(); rtrue; }</div>
<div class="codeline">&ensp;&ensp;&ensp;rfalse;</div>
<div class="codeline">];</div>
<div class="codeline">-).</div>
</div><p>The rule should return false if it wants to make no decision, but call either RulebookSucceeds or RulebookFails and return true if it does. These routines can optionally take an argument: which will be the return value from the rulebook.</p>
<p>Note that UNDERGROUND_R itself has no arguments. In the case of an action based rulebook, the I6 variables noun, second and actor can be referred to, while for a value based rulebook the parameter is stored in the I6 global variable parameter_object (which is not necessarily an object, in spite of the name).</p>
<p>We can put this rule into a rulebook in the same way that any named rule can be:</p>
<div class="codeblock"><div class="codeline">The underground rule is listed in the spot danger rules.</div>
</div><h3 id="section_21">WI §27.21 Inform 6 objects and classes</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_20" title="Primitive Inform 6 declarations of rules"><div class="nav-arrow">←27.20 </div><div class="doc-navbar-text">Primitive Inform 6 declarations of rules</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_22"><div class="doc-navbar-text">Inform 6 variables, properties, actions, and attributes</div><div class="nav-arrow">27.22→</div></a></div></div></div>
<p>As might be expected, I7 compiles an I6 class for each kind, and an I6 object for each of its own objects. We can meddle with its compilation process here using a further refinement of Include. For instance, suppose we want the I6 class definition for things to come out containing a property like this:</p>
<div class="codeblock"><div class="codeline">Class K2_thing ...</div>
<div class="codeline">&ensp;&ensp;&ensp;with marmalade_jar_size 6,</div>
<div class="codeline">&ensp;&ensp;&ensp;...</div>
</div><p>How to arrange this? One way is to create an ordinary I7 property, like so:</p>
<div class="codeblock"><div class="codeline">A thing has a number called marmalade jar size. The marmalade jar size of a thing is usually 6. The marmalade jar size property translates into I6 as &quot;marmalade_jar_size&quot;.</div>
</div><p>(Without that last sentence, the property won&#39;t get any familiar name.) But sometimes we need more, and want to actually write new material to go into the definition. This can be done like so:</p>
<div class="codeblock"><div class="codeline">Include (- with before [; Go: return 1; ], -) when defining a vehicle.</div>
</div><p>This glues in a new property to the class compiled to represent the I7 kind &quot;vehicle&quot;. (See the DM4 for why. However, since the entire actions machinery is different in the I7 world, note that &quot;after&quot;, &quot;react_before&quot; and &quot;react_after&quot; no longer have any effect, and nor does &quot;before&quot; for rooms.)</p>
<p>And similarly:</p>
<div class="codeblock"><div class="codeline">Include (- has my_funny_attribute, -) when defining the hot air balloon.</div>
</div><p>If we need a particular I7 object or kind to end up with a particular I6 name, we can write:</p>
<div class="codeblock"><div class="codeline">The whatsit object translates into I6 as &quot;whatsit&quot;.</div>
<div class="codeline">The thingummy kind translates into I6 as &quot;thingummy_class&quot;.</div>
</div><p>WARNING: The &quot;Include (- &hellip; -) when defining &hellip;&quot; usage still works for the moment (except in projects compiled to C at the command line, where it may fail), but it is deprecated and likely to be removed in later versions of Inform. Avoid it if at all possible.</p>
<h3 id="section_22">WI §27.22 Inform 6 variables, properties, actions, and attributes</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_21" title="Inform 6 objects and classes"><div class="nav-arrow">←27.21 </div><div class="doc-navbar-text">Inform 6 objects and classes</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_23"><div class="doc-navbar-text">Inform 6 Understand tokens</div><div class="nav-arrow">27.23→</div></a></div></div></div>
<p>I7&#39;s variables are usually compiled as entries in an array rather than as I6 variables. However, we can instead tell Inform to use an existing I6 variable (either one that we declare ourselves, or one in the I6 template layer). For example:</p>
<div class="codeblock"><div class="codeline">Room description style is a kind of value. The room description styles are Brief, Verbose and Superbrief.</div>
<div class="codeline">The current room description style is a room description style that varies.</div>
<div class="codeline">The current room description style variable translates into I6 as &quot;lookmode&quot;.</div>
</div><p>This is a feature provided to help I7 source text to use variables internal to the I6 template code. It can, if really necessary, also be used to give I7 names to entirely new I6-level variables, created like so:</p>
<div class="codeblock"><div class="codeline">Include (- Global my_variable = 0; -).</div>
</div><p>This style of hybrid coding is really not encouraged.</p>
<p>I7&#39;s properties are compiled sometimes as I6 properties, sometimes as I6 attributes, sometimes as bits in a bitmap somewhere. However, we can override I7 by telling it that one of its property names is equivalent to an already-existing I6 property or attribute: if so then I7 will use that name and will not compile any directive to create it. For example:</p>
<div class="codeblock"><div class="codeline">The switched on property translates into I6 as &quot;on&quot;.</div>
<div class="codeline">The initial appearance property translates into I6 as &quot;initial&quot;.</div>
</div><p>We do not need to translate &quot;switched off&quot;, the opposite to &quot;switched on&quot;: I7 will now compile this to &quot;~on&quot;.</p>
<p>Lastly, actions can also be translated (though it&#39;s usually better to translate their rules instead and invent new I7 actions covering them):</p>
<div class="codeblock"><div class="codeline">The unlocking it with action translates into I6 as &quot;Unlock&quot;.</div>
</div><h3 id="section_23">WI §27.23 Inform 6 Understand tokens</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_22" title="Inform 6 variables, properties, actions, and attributes"><div class="nav-arrow">←27.22 </div><div class="doc-navbar-text">Inform 6 variables, properties, actions, and attributes</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_24"><div class="doc-navbar-text">Inform 6 adjectives</div><div class="nav-arrow">27.24→</div></a></div></div></div>
<p>The parser which deciphers the player&#39;s typed commands is written in I6, and many of the basic tokens of Understand grammar are implemented as &quot;general parsing routines&quot; (GPRs), the specification of which is described fully in the Inform 6 Designer&#39;s Manual. I7 translates much of the source text&#39;s Understand grammar into GPRs, and once again we can bypass this process and supply an Understand token directly as an I6 GPR. For example:</p>
<div class="codeblock"><div class="codeline">The Understand token squiggle translates into I6 as &quot;SQUIGGLE_TOKEN&quot;.</div>
</div><p>We then have to include a routine of that name into I7&#39;s output using the &quot;Include&quot; instruction, on which more later.</p>
<p>This creates a token &quot;[squiggle]&quot;; so for instance if the source text contains:</p>
<div class="codeblock"><div class="codeline">Understand &quot;copy [squiggle]&quot; as ...</div>
</div><p>then Inform would parse the command COPY FIGURE EIGHT by calling the SQUIGGLE_TOKEN routine as a GPR with the word marker at 2, that is, at the word FIGURE.</p>
<p>As always, this should be done only where there seems no better way, or where speed is very important. For any fairly simple range of possibilities, it&#39;s better to use the techniques in the Understand chapter, or to use unit specifications.</p>
<h3 id="section_24">WI §27.24 Inform 6 adjectives</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_23" title="Inform 6 Understand tokens"><div class="nav-arrow">←27.23 </div><div class="doc-navbar-text">Inform 6 Understand tokens</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_25"><div class="doc-navbar-text">Naming Unicode characters</div><div class="nav-arrow">27.25→</div></a></div></div></div>
<p>There are three ways to specify that an adjective is defined at the I6 level. For example:</p>
<div class="codeblock"><div class="codeline">Definition: a number is prime rather than composite if I6 routine</div>
<div class="codeline">&ensp;&ensp;&ensp;&quot;PRIMALITY_TEST&quot; says so (it is greater than 1 and is divisible only by itself and 1).</div>
</div><p>Inform now actually tests if a number N is prime by calling PRIMALITY_TEST(N), and it assumes that we have also included such a routine in the output. The routine is expected to return true or false accordingly.</p>
<p>The text in brackets does nothing functional, but is the text used in the Lexicon dictionary part of the Phrasebook index for the user&#39;s benefit; it should be a brief definition. Extension authors are asked to provide these little definitions, so that their users won&#39;t be confused by blank lexicon entries.</p>
<p>The second way makes a more capable adjective, since it can not only be tested, but also made true or false using &quot;now&quot;. For example:</p>
<div class="codeblock"><div class="codeline">Definition: a scene is crucial if I6 routine &quot;SceneCrucial&quot; makes it so</div>
<div class="codeline">&ensp;&ensp;&ensp;(it is essential to winning).</div>
</div><p>The difference here is &quot;makes it so&quot;, not &quot;says so&quot;, and as this implies, the routine has more power. &quot;SceneCrucial&quot; is called with two arguments: SceneCrucial(S, -1) tests whether the scene is crucial or not and returns true or false; SceneCrucial(S, true) must make it true; and SceneCrucial(S, false) must make it false. Another useful difference is that if the kind of value is one which is stored in block form (e.g. for an adjective applying to text), the routine is given a pointer to the block, not a fresh copy.</p>
<p>A third way to define an adjective, which should be used only if speed is exceptionally important, is to provide a &quot;schema&quot; &ndash; a sort of I6 macro, like those provided by the C preprocessor. For example:</p>
<div class="codeblock"><div class="codeline">Definition: a rulebook is exciting if I6 condition</div>
<div class="codeline">&ensp;&ensp;&ensp;&quot;excitement_array--&gt;(*1)==1&quot; says so (it is really wild).</div>
</div><p>The escape &quot;*1&quot; is expanded to the value on which the adjective is being tested. (This is usually faster than calling a routine, but in case of side-effects, the &quot;*1&quot; should occur only once in the condition, just as with a C macro.) To repeat: if in doubt, use the I6 routine method above.</p>
<h3 id="section_25">WI §27.25 Naming Unicode characters</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_24" title="Inform 6 adjectives"><div class="nav-arrow">←27.24 </div><div class="doc-navbar-text">Inform 6 adjectives</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_26"><div class="doc-navbar-text">Overriding definitions in kits</div><div class="nav-arrow">27.26→</div></a></div></div></div>
<p>Inform allows the Unicode characters to be identified either with a decimal number or by name, but it has none of the character names built-in, and for efficiency reasons it only learns them when necessary.</p>
<p>Users normally teach these names to Inform by including one of the extensions &quot;Unicode Character Names&quot; or &quot;Unicode Full Character Names&quot;, which consist of many hundreds of sentences like so:</p>
<div class="codeblock"><div class="codeline">anticlockwise open circle arrow translates into Unicode as 8634.</div>
</div><p>Nothing restricts this usage to those extensions.</p>
<h3 id="section_26">WI §27.26 Overriding definitions in kits</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_25" title="Naming Unicode characters"><div class="nav-arrow">←27.25 </div><div class="doc-navbar-text">Naming Unicode characters</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_27"><div class="doc-navbar-text">Translating the language of play</div><div class="nav-arrow">27.27→</div></a></div></div></div>
<p>When Go is clicked, Inform translates the I7 source text into a large body of so-called &quot;Inter&quot; code: &quot;Inter&quot; is short for &quot;intermediate&quot;. Large as this program is, it could not survive on its own: it needs a large body of pre-compiled code, also written in Inter, to sustain it. This additional material is organised in blocks called &quot;kits&quot;. Most Inform users never need to know about kits, but for example, a typical Inform project includes kits called BasicInformKit, WorldModelKit and CommandParserKit.</p>
<p>These kits are compiled from what is (nearly) Inform 6-syntax source code, and for the details of that, see the documentation on the low-level tool &quot;inter&quot;. While it&#39;s absolutely possible for Inform users to create and use their own kits, that&#39;s beyond the scope of this book. But what we will cover here is the ability to include just a little extra Inter code &ndash; perhaps only a few functions or constants.</p>
<p>In fact, we have seen the necessary syntax already:</p>
<div class="codeblock"><div class="codeline">Include (- ... -).</div>
</div><p>puts the given material &quot;&hellip;&quot; into the project. For example:</p>
<div class="codeblock"><div class="codeline">Include (-</div>
<div class="codeline">&ensp;&ensp;&ensp;[ ExtraFunction a b; return a*b; ];</div>
<div class="codeline">-).</div>
</div><p>adds just a single function called &quot;ExtraFunction&quot;.</p>
<p>And this works fine, but if we tried the same trick to create a function called &quot;SquareRoot&quot;, for example, then the result would be a problem message &ndash; because BasicInformKit also defines a function of the same name. This problem message is useful, because it warns us about accidental name clashes.</p>
<p>But what if the name clash was not an accident at all, and what we actually wanted to give our own definition of &quot;SquareRoot&quot;, to be used instead of the one in BasicInformKit? This is also possible:</p>
<div class="codeblock"><div class="codeline">Include (-</div>
<div class="codeline">[ SquareRoot num;</div>
<div class="codeline">&ensp;&ensp;&ensp;&quot;Nobody cares about square roots, son.&quot;;</div>
<div class="codeline">];</div>
<div class="codeline">-) replacing &quot;SquareRoot&quot;.</div>
</div><p>And now whenever square roots are calculated, this snarky text will be printed, and the result will always be rather meaningless (since this I6 routine always returns 1). Unless one is very careful, the result of replacing kit definitions can be absolute chaos.</p>
<p>An important historical note: between about 2010 and 2021, kits did not exist, and instead there were &quot;template files&quot; of Inform 6 code which served roughly then same purpose. These had names like &quot;Relations.i6t&quot; or &quot;Mathematics.i6t&quot; and were internally divided into named subsections; and Inform supported syntax like the following:</p>
<div class="codeblock"><div class="codeline">Include (- ... -) before &quot;Relations.i6t&quot;.</div>
<div class="codeline">Include (- ... -) instead of &quot;Relations.i6t&quot;.</div>
<div class="codeline">Include (- ... -) after &quot;Symmetric One To One Relations&quot; in &quot;Relations.i6t&quot;.</div>
</div><p>to allow new material to be placed at oddball positions in the final code. There is now no need to worry about the placement of code &ndash; Inform&#39;s final code generator manages things so that code-ordering issues do not arise; as a result, the &quot;before&quot; and &quot;after&quot; options are now unnecessary. For now, Inform ignores these usages, and just disregards the &quot;before&hellip;&quot; or &quot;after&hellip;&quot; parts. But in some later version of Inform they will begin to cause problem messages, so writers of extensions using these syntaxes should now please remove them.</p>
<p>The &quot;instead of&quot; option now cannot work at all, and throws a problem message. The new way to substitute a fresh definition of something built-in is to use the &quot;replacing&quot; notation described above.</p>
<p>With the demise of the &quot;template layer&quot;, as it was called, another form of so-called &quot;template hacking&quot; has gone with it &ndash; the special notation:</p>
<div class="codeblock"><div class="codeline">Include (- {-segment:MyStuff.i6t} -).</div>
</div><p>to allow a whole extra file of Inform 6 code called &quot;MyStuff.i6t&quot; to be pasted in. The new way to do that is to create a new kit, say MyStuffKit, to hold the material in question. This is not hard to do, but beyond the scope of this book. See the documentation on the low-level Inform tool &quot;inter&quot;.</p>
<h3 id="section_27">WI §27.27 Translating the language of play</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_26" title="Overriding definitions in kits"><div class="nav-arrow">←27.26 </div><div class="doc-navbar-text">Overriding definitions in kits</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_28"><div class="doc-navbar-text">Segmented substitutions</div><div class="nav-arrow">27.28→</div></a></div></div></div>
<p>The &quot;language of play&quot; is the natural language used to communicate with the player at run-time: this is normally English.</p>
<p>That means that it is difficult to write, say, Spanish-language IF using Inform 7, though heroic work by the Spanish IF community has overcome this. Inform 6 provided for translation by isolating its linguistic code in a part of the I6 library called the &quot;language definition file&quot;, which was normally &quot;English.h&quot;. Translations were gradually made to most major European languages, resulting in alternative language definition files called &quot;French.h&quot;, &quot;Italian.h&quot; and so on. Full details on how to write a language definition file were given in the Translations chapter of the DM4, that is, the fourth edition of the Inform 6 Designer&#39;s Manual.</p>
<p>In I7 the system is different. We use the template, not a library. Instead of providing a language definition file such as &quot;French.h&quot;, a translator should create an extension called something like &quot;French Language by Jacques Mensonge&quot;. (The language should be named in English, so &quot;French Language by &hellip;&quot;, not &quot;Langue français by &hellip;&quot;) This extension should then contain broadly the same material as an I6 language definition file, but written in a mostly higher-level way. See the extension &quot;English Language by Graham Nelson&quot; supplied with I7, which is included automatically by default.</p>
<h3 id="section_28">WI §27.28 Segmented substitutions</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_27" title="Translating the language of play"><div class="nav-arrow">←27.27 </div><div class="doc-navbar-text">Translating the language of play</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_29"><div class="doc-navbar-text">Invocation labels, counters and storage</div><div class="nav-arrow">27.29→</div></a></div></div></div>
<p>A &quot;segmented&quot; substitution is a syntax where text is placed between two or more different text substitutions. Examples include:</p>
<div class="codeblock"><div class="codeline">&quot;This hotel is [if the player is female]just awful[otherwise]basic[end if].&quot;</div>
<div class="codeline">&quot;Annie [one of]dances[or]sulks[or]hangs out at Remo&#39;s[at random].&quot;</div>
</div><p>To create such syntaxes, it is not enough just to define how each expands into I6 code: for one thing we may need to know about the later terms in order to expand the earlier ones, which is normally impossible, and for another thing, the individual text substitutions mean nothing in isolation. For instance, Inform produces a problem if the following is tried:</p>
<div class="codeblock"><div class="codeline">&quot;The hotel [at random] is on fire.&quot;</div>
</div><p>because &quot;[at random]&quot; is only legal when closing a &quot;[one of] &hellip;&quot; construction. But if &quot;[at random]&quot; had been defined as just another text substitution, Inform would not have been able to detect such problems.</p>
<p>Inform therefore allows us to mark text substitutions as being any of three special kinds: beginning, in the middle of, or ending a segmented substitution. There can be any number of alternative forms for each of these three variants. The syntax policed is that</p>
<div class="codeblock"><div class="codeline">(a) Any usage must lie entirely within a single say or piece of text.</div>
<div class="codeline">(b) It must begin with exactly one of the substitutions marked as &quot;beginning&quot;.</div>
<div class="codeline">(c) It can contain any number, including none, of the substitutions marked as &quot;continuing&quot; (if there are any).</div>
<div class="codeline">(d) It must end with exactly one of the substitutions marked as &quot;ending&quot;.</div>
</div><p>A simple example:</p>
<div class="codeblock"><div class="codeline">To say emphasis on -- beginning say_emphasis_on: (- style underline; -).</div>
<div class="codeline">To say emphasis off -- ending say_emphasis_on: (- style roman; -).</div>
</div><p>This creates &quot;[emphasis on]&quot; and &quot;[emphasis off]&quot; such that they can only be used as a pair. The keyword &quot;say_emphasis_on&quot;, which must be a valid I6 identifier (and hence a single word), is never seen by the user: it is simply an ID token so that Inform can identify the construction to which these belong. (We recommend that anybody creating such constructions should choose an ID token which consists of the construction&#39;s name but with underscores in place of spaces: this means that the namespace for ID tokens will only clash if the primary definitions would have clashed in any case.)</p>
<div class="examples">
<h4>Example</h4>
<div class="example-short"><div class="example-short-num"><span class="hidden"></span>452.</div><div class="example-short-name"><span class="example-short-name"><a href="examples/chanel_version.html">Chanel Version 1</a></span> <span class="stars">★</span></div></div><div class="example-short"><div class="example-short-num"><span class="hidden">000.</span></div><div class="example-short-name">Making paired italic and boldface tags like those used by HTML for web pages.</div></div>
<div class="linkback"><a href="RB_12.html#section_1" title="Typography, Layout, and Multimedia Effects &gt; Typography">RB §12.1 Typography</a></div>
</div>
<h3 id="section_29">WI §27.29 Invocation labels, counters and storage</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_28" title="Segmented substitutions"><div class="nav-arrow">←27.28 </div><div class="doc-navbar-text">Segmented substitutions</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="#section_30"><div class="doc-navbar-text">To say one of</div><div class="nav-arrow">27.30→</div></a></div></div></div>
<p>The process of expanding the I6 code which represents a phrase is called &quot;invocation&quot;. As we have seen, when a phrase is defined using a single piece of I6 code, invocation consists of copying out that I6 code, except that tokens in braces &quot;{thus}&quot; are replaced:</p>
<div class="codeblock"><div class="codeline">To say (something - number): (- print {something}; -).</div>
</div><p>Ordinarily the only token names allowed are those matching up with names in the prototype, as here, but we have already seen one special syntax: &quot;{phrase options}&quot;, which expands as a bitmap of the options chosen. And in fact the invocation language is larger still, as a skim through the Standard Rules will show. The notes below deliberately cover only some of its features: those which are likely to remain part of the permanent design of Inform, and which are adaptable to many uses. <strong>Please do not use any of the undocumented invocation syntaxes: they change frequently, without notice or even mention in the change log.</strong></p>
<p>The first special syntaxes are textual tricks. {-delete} deletes the most recent character in the I6 expansion of the phrase so far. {-erase} erases the I6 expansion of the phrase so far. {-open-brace} and {-close-brace} produce literal &quot;{&quot; and &quot;}&quot; characters.</p>
<p>The following:</p>
<div class="codeblock"><div class="codeline">{-counter:NAME}</div>
<div class="codeline">{-counter-up:NAME}</div>
<div class="codeline">{-zero-counter:NAME}</div>
<div class="codeline">{-counter-makes-array:NAME}</div>
</div><p>create (if one does not already exist) a counter called NAME. This is initially zero, and can be reset back to zero using &quot;{-zero-counter:NAME}&quot;, which expands into no text. The token &quot;{-counter:NAME}&quot; expands into the current value of the counter, as a literal decimal number. The token &quot;{-counter-up:NAME}&quot; does the same, but then also increases it by one. Finally, the token &quot;{-counter-makes-array:NAME}&quot; expands to nothing, but tells Inform to create an &quot;--&gt;&quot; array called &quot;I7_ST_NAME&quot; which includes entries from 0 up to the final value of the NAME counter.</p>
<p>This allows each instance in the source text of a given phrase to have both (i) a unique ID number for that invocation, and (ii) its own word of run-time storage, which can allow it to have a state preserved in between times when it is executed. For example:</p>
<div class="codeblock"><div class="codeline">To say once only -- beginning say_once_only:</div>
<div class="codeline">&ensp;&ensp;&ensp;(- {-counter-makes-array:say_once_only}if (I7_ST_say_once_only--&gt;{-counter:say_once_only} == false) {-open-brace} I7_ST_say_once_only--&gt;{-counter-up:say_once_only} = true; -).</div>
<div class="codeline">To say end once only -- ending say_once_only:</div>
<div class="codeline">&ensp;&ensp;&ensp;(- {-close-brace} -).</div>
</div><p>To complete the tools available for defining a segmented substitution, we need a way for the definition of the head to know about the middle segments and the tail:</p>
<p>When invoking either the head or the tail, {-segment-count} expands to the literal decimal number of pieces of text in between the two, which is always one more than the number of middle segments, since the text comes in between the segments. When invoking any middle segment, {-segment-count} expands to the number of pieces of text so far -- thus it expands to 1 on the first middle segment invoked, 2 on the next, and so on.</p>
<p>Lastly {-final-segment-marker} expands to the I6 identifier which marks the end segment, or to I6_NULL if the end segment has no marker. The idea of markers is to enable the head&#39;s definition to know which of a number of choices has been used for the tail, supposing that this is a construction with a variety of legal endings. For example:</p>
<div class="codeblock"><div class="codeline">To say emphasise -- beginning say_emphasise:</div>
<div class="codeline">&ensp;&ensp;&ensp;(- style {-final-segment-marker}; -).</div>
<div class="codeline">To say with italics -- ending say_emphasise with marker underline:</div>
<div class="codeline">&ensp;&ensp;&ensp;(- style roman; -).</div>
<div class="codeline">To say with fixed space type -- ending say_emphasise with marker fixed:</div>
<div class="codeline">&ensp;&ensp;&ensp;(- style roman; -).</div>
</div><p>The markers used for the tails here are &quot;underline&quot; and &quot;fixed&quot;, and when the head is invoked, the marker for its tail is expanded into the argument of I6&#39;s &quot;style&quot; statement.</p>
<p>The examples above are all to do with segmented substitutions, which is where they are most useful, but most of the syntaxes above work equally well for ordinary &quot;To&hellip;&quot; phrase definitions.</p>
<h3 id="section_30">WI §27.30 To say one of</h3>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="#section_29" title="Invocation labels, counters and storage"><div class="nav-arrow">←27.29 </div><div class="doc-navbar-text">Invocation labels, counters and storage</div></a></div><div class="doc-navbar-center"><a class="nav-el" href="#chapter_27"><div class="nav-arrow">↑27. </div><div class="doc-navbar-text">Extensions</div></a></div><div class="doc-navbar-right"><a class="nav-el" href="RB_1.html" title="How to Use The Recipe Book"><div class="doc-navbar-text">How to Use The Recipe Book</div><div class="nav-arrow">RB 1.→</div></a></div></div></div>
<p>Many of the invocation syntaxes described in the previous section are used in the definition by the Standard Rules of the &quot;[one of] &hellip; [or] &hellip; [purely at random]&quot; construction, so it makes a good example of how they can be used.</p>
<p>First, this is a segmented substitution with a single possible beginning (&quot;[one of]&quot;), a single possible middle (&quot;[or]&quot;) but a choice of many possible endings. Almost everything is compiled by the invocation of the beginning:</p>
<div class="codeblock"><div class="codeline">To say one of -- beginning say_one_of (documented at phs_oneof): (-</div>
<div class="codeline">&ensp;&ensp;&ensp;{-counter-makes-array:say_one_of}</div>
<div class="codeline">&ensp;&ensp;&ensp;{-counter-makes-array:say_one_flag}</div>
<div class="codeline">&ensp;&ensp;&ensp;if (I7_ST_say_one_flag--&gt;{-counter:say_one_flag} == false) {</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;I7_ST_say_one_of--&gt;{-counter:say_one_of} = {-final-segment-marker}(I7_ST_say_one_of--&gt;{-counter:say_one_of},</div>
<div class="codeline">{-segment-count});</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;I7_ST_say_one_flag--&gt;{-counter:say_one_flag} = true;</div>
<div class="codeline">&ensp;&ensp;&ensp;}</div>
<div class="codeline">&ensp;&ensp;&ensp;if (say__comp == false) I7_ST_say_one_flag--&gt;{-counter:say_one_flag}{-counter-up:say_one_flag} =</div>
<div class="codeline">false;</div>
<div class="codeline">&ensp;&ensp;&ensp;switch ((I7_ST_say_one_of--&gt;{-counter:say_one_of}{-counter-up:say_one_of})%({-segment-count}+1)-1)</div>
<div class="codeline">{-open-brace}</div>
<div class="codeline">&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;0: -).</div>
<div class="codeline">To say or -- continuing say_one_of (documented at phs_or):</div>
<div class="codeline">&ensp;&ensp;&ensp;(- @nop; {-segment-count}: -).</div>
<div class="codeline">To say purely at random -- ending say_one_of with marker I7_SOO_PAR (documented at phs_purelyrandom):</div>
<div class="codeline">&ensp;&ensp;&ensp;(- {-close-brace} -).</div>
</div><p>The 3rd invocation of this (say) might compile the following:</p>
<div class="codeblock"><div class="codeline">I7_ST_say_one_of--&gt;2 = I7_SOO_PAR(I7_ST_say_one_of--&gt;2, 4);</div>
<div class="codeline">switch((I7_ST_say_one_of--&gt;2)%5 - 1) {</div>
<div class="codeline">&ensp;&ensp;&ensp;0: ... first text ...</div>
<div class="codeline">&ensp;&ensp;&ensp;1: ... second text ...</div>
<div class="codeline">&ensp;&ensp;&ensp;2: ... third text ...</div>
<div class="codeline">&ensp;&ensp;&ensp;3: ... fourth text ...</div>
<div class="codeline">}</div>
</div><p>First, we notified Inform that it needs to allocate an array (I7_ST_say_one_of) providing storage associated with the counter &quot;say_one_of&quot;. This we used to count off individual invocations of &quot;[one of]&quot;, so that each would have its own word of storage &ndash; for the 3rd invocation, I7_ST_say_one_of--&gt;2. We then call a state-changing routine, in this case I7_SOO_PAR, which is allowed to know the previous state and also the number of options available, and which returns the new state. The state is supposed to be the option chosen last time, but that means that there are not 4, but 5 possibilities: 0 for &quot;there was no last time&quot;, then 1 to 4 for the possible outcomes. We reduce the state mod 5 to obtain the decision this time, and subtract 1 because it happens to be convenient to make the switch statement run from 0 to 3 rather than 1 to 4. (The reason we reduce the state mod 5 is to allow the state-changer to squirrel away secret information in the upper bits of the state, if it wants to. Note that subtracting one means that the switch value might be -1, which results in no text being printed: thus if the state-changer chooses 0, it can decide on none of the above.)</p>
<p>In this design, the marker attached to the choice of ending substitution is the name of the I6 state-changer: here is the I7_SOO_PAR routine.</p>
<div class="codeblock"><div class="codeline">[ I7_SOO_PAR oldval count; if (count &lt;= 1) return count; return random(count); ];</div>
</div><p>As it happens, this ignores the old value: after all, it is meant to be purely at random, and nothing could be less pure than taking the last outcome into consideration when choosing the next.</p>
<p>Note that the counter say_one_of is advanced in invocation of the head. It might seem that the tidier design, somehow, would be to advance the counter in the invocation of the tails, but this is not a good idea. In general it is not safe to assume that the counter will have the same value when the tail is invoked that it had when the head was invoked, because segmented say constructions can legally be nested in Inform strings. Because of this, it is best to deal with a counter entirely in a single invocation, either of the beginning or the ending.</p>
<p>Because &quot;[one of] &hellip; [or] &hellip;&quot; is such a useful construction &ndash; switching between alternative forms of text, which writers of IF very often do &ndash; the above implementation is intentionally left open for new endings to be added, and the examples below show how easily this can be done.</p>
<div class="examples">
<h4>Examples</h4>
<div class="example-short"><div class="example-short-num"><span class="hidden"></span>453.</div><div class="example-short-name"><span class="example-short-name"><a href="examples/blink.html">Blink</a></span> <span class="stars">★</span></div></div><div class="example-short"><div class="example-short-num"><span class="hidden">000.</span></div><div class="example-short-name">Making a &quot;by atmosphere&quot; token, allowing us to design our own text variations such as &quot;[one of]normal[or]gloomy[or]scary[by atmosphere]&quot;.</div></div>
<div class="linkback"><a href="RB_2.html#section_1" title="Adaptive Prose &gt; Varying What Is Written">RB §2.1 Varying What Is Written</a></div>
<div class="example-short"><div class="example-short-num"><span class="hidden"></span>454.</div><div class="example-short-name"><span class="example-short-name"><a href="examples/uncommon_ground.html">Uncommon Ground</a></span> <span class="stars">★★</span></div></div><div class="example-short"><div class="example-short-num"><span class="hidden">000.</span></div><div class="example-short-name">Making a &quot;by viewpoint&quot; token, allowing us to design our own text variations such as &quot;[show to yourself]quaint[to Lolita]thrilling[to everyone else]squalid[end show]&quot; depending on the identity of the player at the moment.</div></div>
<div class="linkback"><a href="RB_5.html#section_6" title="The Viewpoint Character &gt; Viewpoint">RB §5.6 Viewpoint</a></div>
</div>
<div class="doc-navbar"><div class="doc-navbar-left"><a class="nav-el" href="WI_26.html"><div class="nav-arrow">←</div> <div class="doc-navbar-text">26. Publishing</div></a></div><div class="doc-navbar-center"><div class="nav-el"><span class="hidden">0</span></div></div><div class="doc-navbar-right"><a class="nav-el" href="RB_1.html" title="How to Use The Recipe Book"><div class="doc-navbar-text">How to Use The Recipe Book</div><div class="nav-arrow">RB 1.→</div></a></div></div></div>
<footer id="credits-footer"><nav><div class="nav-el"><a class="nav-el" href="index.html">Contents</a></div><div class="nav-el"><a class="nav-el" href="examples/index.html">Examples</a></div><div class="nav-el"><a class="nav-el" href="general_index.html">Index</a></div><div class="nav-el"><a class="nav-el" href="search.html">Search</a></div></nav>
<div class="footing"><p id="i7credit"><a href="http://inform7.com">Inform 7</a> and its documentation are &copy; 2006-<span id="current_year">2022</span> by Graham Nelson and published under the <a href="license.html">Artistic License 2.0</a>.</p><p class="about"><a class="nav-about" href="about.html">About this edition</a> &bull; <a class="nav-about" href="https://twitter.com/inform7tips">@inform7tips</a></p></div></footer>
</body></html>
